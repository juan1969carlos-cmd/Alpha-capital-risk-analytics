<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alpha Capital ‚Äî Risk Analytics v2</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --void:       #07090D;
  --surface:    #0C1117;
  --panel:      #101820;
  --panel2:     #141E28;
  --border:     #1A2838;
  --border2:    #223040;
  --amber:      #C8920A;
  --amber-dim:  #7A5808;
  --amber-glow: #F0B429;
  --amber-pale: #251C06;
  --cyan:       #0ABFC8;
  --cyan-dim:   #073E42;
  --green:      #0AC871;
  --green-dim:  #052E18;
  --red:        #E03030;
  --red-dim:    #2E0A0A;
  --text-pri:   #E4D8C0;
  --text-sec:   #7A7060;
  --text-dim:   #3A3428;
  --white:      #F4EFE6;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:13px;scroll-behavior:smooth}
body{background:var(--void);color:var(--text-pri);font-family:'DM Mono',monospace;min-height:100vh;overflow-x:hidden;cursor:crosshair}

/* Scanlines */
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.06) 2px,rgba(0,0,0,0.06) 4px);pointer-events:none;z-index:9999}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.masthead{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:16px 28px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0A0E16 0%,transparent 100%);position:sticky;top:0;z-index:200;backdrop-filter:blur(8px)}
.ml{display:flex;align-items:center;gap:14px}
.logo{width:34px;height:34px;background:var(--amber-pale);border:1.5px solid var(--amber-dim);display:flex;align-items:center;justify-content:center;clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%)}
.logo span{font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--amber-glow)}
.firm{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;letter-spacing:.12em;color:var(--white);text-transform:uppercase}
.firm-sub{font-size:8px;letter-spacing:.22em;color:var(--text-sec);text-transform:uppercase;margin-top:2px}
.mc{text-align:center}
.mc-title{font-family:'Cormorant Garamond',serif;font-size:10px;font-weight:300;font-style:italic;letter-spacing:.3em;color:var(--amber-dim);text-transform:uppercase}
.mr{display:flex;align-items:center;justify-content:flex-end;gap:16px}
.live{display:flex;align-items:center;gap:5px;font-size:8px;letter-spacing:.2em;color:var(--green);text-transform:uppercase}
.dot{width:5px;height:5px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(10,200,113,.4)}50%{opacity:.5;box-shadow:0 0 0 5px rgba(10,200,113,0)}}
.ts{font-size:9px;color:var(--text-sec);letter-spacing:.06em}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tab-bar{display:flex;border-bottom:1px solid var(--border);background:var(--panel);padding:0 28px;gap:0;position:sticky;top:65px;z-index:150}
.tab{padding:12px 20px;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--text-sec);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;user-select:none;white-space:nowrap}
.tab:hover{color:var(--text-pri)}
.tab.active{color:var(--amber-glow);border-bottom-color:var(--amber-glow)}

/* ‚îÄ‚îÄ TICKER ‚îÄ‚îÄ */
.ticker-wrap{background:var(--panel);border-bottom:1px solid var(--border);overflow:hidden;padding:6px 0}
.ticker-inner{display:flex;animation:scroll 50s linear infinite;width:max-content}
.ticker-inner:hover{animation-play-state:paused}
@keyframes scroll{to{transform:translateX(-50%)}}
.ti{display:flex;align-items:center;gap:7px;padding:0 20px;border-right:1px solid var(--border);font-size:9px;letter-spacing:.05em;white-space:nowrap}
.ti .s{color:var(--amber-glow);font-weight:500}
.ti .v{color:var(--text-pri)}
.ti .u{color:var(--green)}
.ti .d{color:var(--red)}

/* ‚îÄ‚îÄ SHELL ‚îÄ‚îÄ */
.shell{max-width:1500px;margin:0 auto;padding:22px 28px}
.page{display:none}.page.active{display:block}

/* ‚îÄ‚îÄ KPI STRIP ‚îÄ‚îÄ */
.kpi-strip{display:grid;grid-template-columns:repeat(6,1fr);gap:1px;background:var(--border);border:1px solid var(--border);margin-bottom:20px;animation:fadeUp .5s ease both}
.kpi{background:var(--surface);padding:14px 16px;position:relative;overflow:hidden;cursor:default;transition:background .2s}
.kpi:hover{background:var(--panel)}
.kpi::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--border2);transition:all .2s}
.kpi.good::before{background:var(--green)}
.kpi.warn::before{background:var(--amber)}
.kpi-lbl{font-size:7px;letter-spacing:.22em;color:var(--text-sec);text-transform:uppercase;margin-bottom:7px}
.kpi-vals{display:flex;align-items:baseline;gap:6px;flex-wrap:wrap}
.kpi-old{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:300;color:var(--text-dim);text-decoration:line-through;text-decoration-color:var(--border2)}
.kpi-new{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:600;color:var(--amber-glow);line-height:1}
.kpi-chg{font-size:8px;letter-spacing:.08em;margin-top:4px}
.kpi-chg.pos{color:var(--green)}.kpi-chg.neg{color:var(--red)}.kpi-chg.neu{color:var(--text-sec)}

/* ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ */
.panel{background:var(--surface);border:1px solid var(--border);animation:fadeUp .5s ease both}
.ph{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid var(--border);background:var(--panel)}
.pt{font-size:8px;letter-spacing:.22em;color:var(--amber);text-transform:uppercase;font-weight:500}
.ps{font-size:8px;color:var(--text-dim);letter-spacing:.1em}
.pb{padding:16px}

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.grid-2{display:grid;grid-template-columns:1fr 360px;gap:18px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px}
.col{display:flex;flex-direction:column;gap:18px}

/* ‚îÄ‚îÄ ALLOCATION TABLE ‚îÄ‚îÄ */
.at{width:100%;border-collapse:collapse}
.at thead tr{border-bottom:1px solid var(--border2)}
.at th{font-size:7px;letter-spacing:.18em;color:var(--text-dim);text-transform:uppercase;padding:0 10px 9px;text-align:right;font-weight:400}
.at th:first-child,.at th:nth-child(2){text-align:left}
.at tbody tr{border-bottom:1px solid rgba(26,40,56,.5);transition:background .15s;cursor:default}
.at tbody tr:hover{background:rgba(200,146,10,.04)}
.at td{padding:9px 10px;font-size:10px;text-align:right;color:var(--text-sec)}
.at td:first-child,.at td:nth-child(2){text-align:left}
.tbadge{font-family:'DM Mono',monospace;font-size:11px;font-weight:500;color:var(--amber-glow);letter-spacing:.04em}
.stag{font-size:8px;color:var(--text-dim);letter-spacing:.06em}

/* Weight slider cell */
.wslider-wrap{display:flex;align-items:center;gap:8px;justify-content:flex-end}
.wslider{-webkit-appearance:none;appearance:none;width:80px;height:3px;background:var(--border2);outline:none;border-radius:2px;cursor:pointer}
.wslider::-webkit-slider-thumb{-webkit-appearance:none;width:10px;height:10px;border-radius:50%;background:var(--amber-glow);cursor:pointer;transition:transform .1s}
.wslider::-webkit-slider-thumb:hover{transform:scale(1.3)}
.wval{font-size:10px;color:var(--amber-glow);min-width:36px;text-align:right;font-weight:500}

.dchip{display:inline-flex;align-items:center;padding:2px 6px;font-size:8px;font-weight:500;letter-spacing:.04em;border-radius:2px}
.dchip.up{background:var(--green-dim);color:var(--green)}
.dchip.dn{background:var(--red-dim);color:var(--red)}
.dchip.flat{background:var(--border);color:var(--text-dim)}

/* ‚îÄ‚îÄ EFFICIENT FRONTIER ‚îÄ‚îÄ */
.ef-wrap{position:relative}
.ef-canvas{display:block;width:100%}
.ef-legend{display:flex;align-items:center;gap:20px;margin-top:12px;flex-wrap:wrap}
.ef-leg-item{display:flex;align-items:center;gap:6px;font-size:9px;color:var(--text-sec);letter-spacing:.06em}
.ef-leg-dot{width:8px;height:8px;border-radius:50%}

/* ‚îÄ‚îÄ CORRELATION MATRIX ‚îÄ‚îÄ */
.corr-wrap{overflow-x:auto}
.corr-table{border-collapse:collapse;font-size:9px;width:100%}
.corr-table th{padding:6px 4px;font-size:7px;letter-spacing:.1em;color:var(--text-dim);text-transform:uppercase;text-align:center;font-weight:400;white-space:nowrap}
.corr-table th:first-child{text-align:left;color:var(--amber-glow);padding-left:0}
.corr-table td{padding:5px 4px;text-align:center;font-size:9px;border:1px solid rgba(26,40,56,.3);transition:opacity .2s}
.corr-table td:first-child{text-align:left;color:var(--amber-glow);font-weight:500;border:none;padding-left:0}
.corr-table tr:hover td{opacity:.7}

/* ‚îÄ‚îÄ MONTE CARLO ‚îÄ‚îÄ */
.mc-viz{position:relative;height:150px;margin-bottom:14px}
.mc-cv{width:100%;height:100%;display:block}
.mc-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1px;background:var(--border)}
.mcs{background:var(--panel);padding:11px;text-align:center}
.mcs .sl{font-size:7px;letter-spacing:.18em;color:var(--text-dim);text-transform:uppercase}
.mcs .sv{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;margin-top:3px}
.mcs .sr{font-size:8px;margin-top:2px}
.mcs:nth-child(1) .sv{color:var(--red)}
.mcs:nth-child(2) .sv{color:var(--amber-glow)}
.mcs:nth-child(3) .sv{color:var(--green)}

/* ‚îÄ‚îÄ DONUT ‚îÄ‚îÄ */
.donut-wrap{display:flex;align-items:center;gap:18px}
.d-svg{width:110px;height:110px;flex-shrink:0}
.d-leg{flex:1;display:flex;flex-direction:column;gap:7px}
.d-row{display:flex;align-items:center;gap:7px}
.d-dot{width:7px;height:7px;border-radius:1px;flex-shrink:0}
.d-name{font-size:9px;color:var(--text-sec);flex:1}
.d-pct{font-size:9px;color:var(--amber-glow);font-weight:500}

/* ‚îÄ‚îÄ RISK TABLE ‚îÄ‚îÄ */
.rt{width:100%;border-collapse:collapse}
.rt tr{border-bottom:1px solid rgba(26,40,56,.6)}
.rt tr:last-child{border-bottom:none}
.rt td{padding:8px 0;font-size:9px}
.rt td:first-child{color:var(--text-sec);letter-spacing:.05em}
.rt td:last-child{text-align:right;color:var(--amber-glow);font-weight:500}
.rt .sep td{height:1px;background:var(--border);padding:0}

/* ‚îÄ‚îÄ INPUTS PANEL (editable weights) ‚îÄ‚îÄ */
.inputs-note{font-size:8px;color:var(--text-sec);letter-spacing:.08em;margin-bottom:12px;padding:8px;background:var(--amber-pale);border-left:2px solid var(--amber-dim)}
.weight-sum-bar{height:4px;background:var(--border2);border-radius:2px;margin:10px 0 4px;overflow:hidden}
.weight-sum-fill{height:100%;border-radius:2px;background:var(--green);transition:width .3s,background .3s}
.weight-sum-lbl{font-size:8px;color:var(--text-sec);display:flex;justify-content:space-between}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{padding:10px 16px;background:transparent;border:1px solid var(--amber-dim);color:var(--amber);font-family:'DM Mono',monospace;font-size:8px;letter-spacing:.2em;text-transform:uppercase;cursor:pointer;position:relative;overflow:hidden;transition:all .2s;width:100%}
.btn::before{content:'';position:absolute;left:-100%;top:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(200,146,10,.08),transparent);transition:left .4s}
.btn:hover{border-color:var(--amber);color:var(--amber-glow);box-shadow:0 0 16px rgba(200,146,10,.1)}
.btn:hover::before{left:100%}
.btn.green{border-color:var(--green);color:var(--green)}
.btn.green:hover{box-shadow:0 0 16px rgba(10,200,113,.1)}
.btn.green::before{background:linear-gradient(90deg,transparent,rgba(10,200,113,.08),transparent)}
.btn-row{display:flex;gap:8px}
.btn-row .btn{flex:1}

/* ‚îÄ‚îÄ GAUGE ‚îÄ‚îÄ */
.gauge-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.gauge-item{background:var(--panel);border:1px solid var(--border);padding:14px;text-align:center}
.gauge-lbl{font-size:7px;letter-spacing:.2em;color:var(--text-dim);text-transform:uppercase;margin-bottom:10px}
.gauge-svg{width:90px;height:52px;margin:0 auto 6px;display:block}
.gauge-val{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;color:var(--amber-glow)}
.gauge-sub{font-size:8px;color:var(--text-sec);margin-top:2px;letter-spacing:.06em}

/* ‚îÄ‚îÄ ALERT BANNER ‚îÄ‚îÄ */
.alert-banner{padding:8px 14px;border-left:2px solid;margin-bottom:8px;font-size:8px;letter-spacing:.08em;display:none}
.alert-banner.show{display:block}
.alert-banner.warn{border-color:var(--amber);background:var(--amber-pale);color:var(--amber)}
.alert-banner.err{border-color:var(--red);background:var(--red-dim);color:var(--red)}
.alert-banner.ok{border-color:var(--green);background:var(--green-dim);color:var(--green)}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.footer{padding:14px 28px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--panel)}
.fn{font-size:8px;color:var(--text-dim);letter-spacing:.08em}
.fstack{display:flex;gap:10px}
.fb{font-size:8px;letter-spacing:.12em;color:var(--text-dim);text-transform:uppercase;padding:3px 8px;border:1px solid var(--border)}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-track{background:var(--void)}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
::-webkit-scrollbar-thumb:hover{background:var(--amber-dim)}

@media(max-width:1100px){.grid-2{grid-template-columns:1fr}.kpi-strip{grid-template-columns:repeat(3,1fr)}}
@media(max-width:700px){.kpi-strip{grid-template-columns:repeat(2,1fr)}.shell{padding:12px}.grid-3{grid-template-columns:1fr}.tab{padding:10px 12px}}
</style>
</head>
<body>

<!-- HEADER -->
<header class="masthead">
  <div class="ml">
    <div class="logo"><span>Œ±</span></div>
    <div>
      <div class="firm">Alpha Capital</div>
      <div class="firm-sub">Management ¬∑ Long/Short Equity ¬∑ $500M AUM</div>
    </div>
  </div>
  <div class="mc"><div class="mc-title">Portfolio Risk Analytics System v2.0</div></div>
  <div class="mr">
    <div class="live"><div class="dot"></div>LIVE</div>
    <div class="ts" id="ts">‚Äî</div>
  </div>
</header>

<!-- TABS -->
<div class="tab-bar">
  <div class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</div>
  <div class="tab" onclick="switchTab('weights')">‚öñÔ∏è Weight Editor</div>
  <div class="tab" onclick="switchTab('frontier')">üìà Efficient Frontier</div>
  <div class="tab" onclick="switchTab('correlation')">üîó Correlations</div>
  <div class="tab" onclick="switchTab('montecarlo')">üé≤ Monte Carlo</div>
</div>

<!-- TICKER -->
<div class="ticker-wrap">
  <div class="ticker-inner" id="ticker"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<main class="shell">

<!-- KPI STRIP (always visible) -->
<div class="kpi-strip" id="kpiStrip"></div>
<div id="alertBanner" class="alert-banner warn">‚ö† Portfolio weights do not sum to 100%. Adjust sliders before recalculating.</div>

<!-- PAGE: DASHBOARD -->
<div class="page active" id="page-dashboard">
  <div class="grid-2">
    <div class="col">
      <!-- Allocation Table -->
      <div class="panel">
        <div class="ph"><span class="pt">Asset Allocation Matrix</span><span class="ps">CURRENT ‚Üí MARKOWITZ OPTIMAL</span></div>
        <div class="pb" style="padding:0">
          <table class="at" id="allocTable">
            <thead><tr>
              <th style="padding-left:16px">Ticker</th>
              <th>Sector</th>
              <th>Current</th>
              <th>Optimal</th>
              <th>Œî</th>
              <th style="padding-right:16px">Opt Value</th>
            </tr></thead>
            <tbody id="allocBody"></tbody>
          </table>
        </div>
      </div>
      <!-- Risk Metrics Table -->
      <div class="panel">
        <div class="ph"><span class="pt">Regulatory Risk Metrics</span><span class="ps">OPTIMAL PORTFOLIO ¬∑ 99% CONF</span></div>
        <div class="pb" style="padding:12px 16px">
          <table class="rt" id="riskTable"></table>
        </div>
      </div>
    </div>
    <div class="col">
      <!-- Gauges -->
      <div class="panel">
        <div class="ph"><span class="pt">Risk Gauges</span><span class="ps">OPTIMAL</span></div>
        <div class="pb"><div class="gauge-grid" id="gaugeGrid"></div></div>
      </div>
      <!-- Donut -->
      <div class="panel">
        <div class="ph"><span class="pt">Sector Concentration</span><span class="ps">OPTIMAL WEIGHTS</span></div>
        <div class="pb">
          <div class="donut-wrap">
            <svg class="d-svg" viewBox="0 0 110 110" id="donutSvg"></svg>
            <div class="d-leg" id="donutLeg"></div>
          </div>
        </div>
      </div>
      <!-- Monte Carlo mini -->
      <div class="panel">
        <div class="ph"><span class="pt">Monte Carlo (Preview)</span><span class="ps">10,000 SCENARIOS</span></div>
        <div class="pb">
          <div class="mc-viz"><canvas class="mc-cv" id="mcMini"></canvas></div>
          <div class="mc-stats" id="mcStatsMini"></div>
        </div>
      </div>
      <!-- Actions -->
      <div class="btn-row">
        <button class="btn green" onclick="exportPDF()">‚Üì Export PDF Report</button>
        <button class="btn" onclick="exportJSON()">‚Üì Export JSON</button>
      </div>
    </div>
  </div>
</div>

<!-- PAGE: WEIGHT EDITOR -->
<div class="page" id="page-weights">
  <div class="grid-2">
    <div class="col">
      <div class="panel">
        <div class="ph"><span class="pt">Interactive Weight Editor</span><span class="ps">DRAG SLIDERS TO REBALANCE</span></div>
        <div class="pb">
          <div class="inputs-note">üîµ Drag sliders to set custom weights. System recalculates all risk metrics in real-time. Weights must sum to 100%.</div>
          <div class="weight-sum-bar"><div class="weight-sum-fill" id="wSumBar" style="width:100%"></div></div>
          <div class="weight-sum-lbl"><span>Portfolio Allocation</span><span id="wSumLbl">100.0%</span></div>
          <br>
          <table class="at" id="editorTable">
            <thead><tr>
              <th style="padding-left:0">Ticker</th>
              <th>Sector</th>
              <th style="text-align:right">Weight</th>
              <th style="text-align:right;width:120px">Slider</th>
              <th style="text-align:right">$ Value</th>
            </tr></thead>
            <tbody id="editorBody"></tbody>
          </table>
          <br>
          <div class="btn-row">
            <button class="btn" onclick="resetToMarkowitz()">‚Ü∫ Reset to Markowitz Optimal</button>
            <button class="btn" onclick="resetToEqual()">= Equal Weight</button>
            <button class="btn green" onclick="applyCustomWeights()">‚úî Apply & Recalculate</button>
          </div>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="panel">
        <div class="ph"><span class="pt">Live Risk Preview</span><span class="ps">UPDATES AS YOU DRAG</span></div>
        <div class="pb">
          <div class="gauge-grid" id="editorGauges"></div>
        </div>
      </div>
      <div class="panel">
        <div class="ph"><span class="pt">Custom vs Optimal Comparison</span><span class="ps">REAL-TIME</span></div>
        <div class="pb" style="padding:10px 16px">
          <table class="rt" id="liveRiskTable"></table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PAGE: EFFICIENT FRONTIER -->
<div class="page" id="page-frontier">
  <div class="panel">
    <div class="ph">
      <span class="pt">Efficient Frontier ‚Äî Markowitz (1952)</span>
      <span class="ps">RISK/RETURN TRADEOFF ¬∑ 500 SIMULATED PORTFOLIOS</span>
    </div>
    <div class="pb">
      <div class="ef-wrap">
        <canvas id="efCanvas" style="width:100%;display:block"></canvas>
      </div>
      <div class="ef-legend" id="efLegend">
        <div class="ef-leg-item"><div class="ef-leg-dot" style="background:#3A4A5A"></div>Random Portfolios</div>
        <div class="ef-leg-item"><div class="ef-leg-dot" style="background:var(--amber-glow)"></div>Efficient Frontier</div>
        <div class="ef-leg-item"><div class="ef-leg-dot" style="background:var(--cyan)"></div>Current Portfolio</div>
        <div class="ef-leg-item"><div class="ef-leg-dot" style="background:var(--green)"></div>Optimal Portfolio (Max Sharpe)</div>
        <div class="ef-leg-item"><div class="ef-leg-dot" style="background:var(--red)"></div>Min Variance Portfolio</div>
        <div class="ef-leg-item"><div class="ef-leg-dot" style="background:#8060C8"></div>Individual Assets</div>
      </div>
      <div style="margin-top:16px;font-size:8px;color:var(--text-sec);letter-spacing:.08em;line-height:1.8">
        La <span style="color:var(--amber-glow)">Frontera Eficiente</span> representa el conjunto de portafolios que maximizan el retorno para cada nivel de riesgo. Ning√∫n portafolio deber√≠a estar por debajo de esta curva ‚Äî si lo est√°, puede mejorar su retorno sin aumentar riesgo, o reducir riesgo sin sacrificar retorno. El punto <span style="color:var(--green)">Sharpe M√°ximo</span> es el √≥ptimo de Markowitz.
      </div>
    </div>
  </div>
</div>

<!-- PAGE: CORRELATIONS -->
<div class="page" id="page-correlation">
  <div class="grid-3" style="margin-bottom:18px">
    <div class="panel">
      <div class="ph"><span class="pt">Highest Correlations</span><span class="ps">RISK CLUSTERS</span></div>
      <div class="pb" style="padding:10px 16px"><table class="rt" id="highCorrTable"></table></div>
    </div>
    <div class="panel">
      <div class="ph"><span class="pt">Lowest Correlations</span><span class="ps">DIVERSIFICATION PAIRS</span></div>
      <div class="pb" style="padding:10px 16px"><table class="rt" id="lowCorrTable"></table></div>
    </div>
    <div class="panel">
      <div class="ph"><span class="pt">Sector Avg Correlation</span><span class="ps">INTRA vs INTER</span></div>
      <div class="pb" style="padding:10px 16px"><table class="rt" id="sectorCorrTable"></table></div>
    </div>
  </div>
  <div class="panel">
    <div class="ph"><span class="pt">Full Correlation Matrix</span><span class="ps">PAIRWISE PEARSON COEFFICIENTS</span></div>
    <div class="pb">
      <div class="corr-wrap"><table class="corr-table" id="corrMatrix"></table></div>
      <div style="margin-top:12px;display:flex;align-items:center;gap:12px;font-size:8px;color:var(--text-sec)">
        <span>Color scale:</span>
        <div style="display:flex;align-items:center;gap:4px">
          <div style="width:60px;height:8px;background:linear-gradient(90deg,#0A3D3F,#1C2A38,#3D0A0A)"></div>
          <span>Low ‚Üí Neutral ‚Üí High</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PAGE: MONTE CARLO -->
<div class="page" id="page-montecarlo">
  <div class="grid-2">
    <div class="col">
      <div class="panel">
        <div class="ph"><span class="pt">Monte Carlo Simulation</span><span class="ps">GEOMETRIC BROWNIAN MOTION ¬∑ 10,000 PATHS</span></div>
        <div class="pb">
          <div class="mc-viz" style="height:280px"><canvas class="mc-cv" id="mcFull"></canvas></div>
        </div>
      </div>
      <div class="panel">
        <div class="ph"><span class="pt">Distribution of Final Values</span><span class="ps">HISTOGRAM ¬∑ 1-YEAR HORIZON</span></div>
        <div class="pb">
          <canvas id="histCanvas" style="width:100%;display:block;height:160px"></canvas>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="panel">
        <div class="ph"><span class="pt">Scenario Analysis</span><span class="ps">PERCENTILE BREAKDOWN</span></div>
        <div class="pb" style="padding:10px 16px"><table class="rt" id="mcDetailTable"></table></div>
      </div>
      <div class="panel">
        <div class="ph"><span class="pt">Simulation Parameters</span><span class="ps">INPUTS</span></div>
        <div class="pb">
          <div class="inputs-note">Parameters used in the Geometric Brownian Motion simulation: dS = Œº¬∑S¬∑dt + œÉ¬∑S¬∑dW</div>
          <table class="rt" id="mcParamsTable"></table>
        </div>
      </div>
      <div class="panel">
        <div class="ph"><span class="pt">Probability Analysis</span><span class="ps">LOSS PROBABILITIES</span></div>
        <div class="pb" style="padding:10px 16px"><table class="rt" id="mcProbTable"></table></div>
      </div>
    </div>
  </div>
</div>

</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="fn">‚ö† Simulated data ¬∑ Educational purposes only ¬∑ Not financial advice ¬∑ Normal distribution assumed</div>
  <div class="fstack">
    <span class="fb">Python</span><span class="fb">JavaScript</span><span class="fb">Java</span><span class="fb">Excel</span>
  </div>
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CORE DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AUM = 500e6, RF = 0.0525, Z99 = 2.3263, Z95 = 1.6449;
const TDAYS = 252;

const BASE = [
  {t:'AAPL', s:'Technology',      cw:0.18, ow:0.250, ret:0.22, vol:0.28, beta:1.21},
  {t:'MSFT', s:'Technology',      cw:0.15, ow:0.250, ret:0.20, vol:0.25, beta:1.15},
  {t:'GOOGL',s:'Technology',      cw:0.12, ow:0.047, ret:0.18, vol:0.27, beta:1.12},
  {t:'AMZN', s:'Consumer Disc.',  cw:0.10, ow:0.020, ret:0.25, vol:0.30, beta:1.28},
  {t:'NVDA', s:'Technology',      cw:0.08, ow:0.103, ret:0.38, vol:0.45, beta:1.55},
  {t:'JPM',  s:'Financials',      cw:0.12, ow:0.020, ret:0.14, vol:0.22, beta:1.05},
  {t:'GS',   s:'Financials',      cw:0.08, ow:0.020, ret:0.16, vol:0.28, beta:1.18},
  {t:'BAC',  s:'Financials',      cw:0.07, ow:0.020, ret:0.13, vol:0.25, beta:1.10},
  {t:'XOM',  s:'Energy',          cw:0.05, ow:0.020, ret:0.09, vol:0.30, beta:0.78},
  {t:'JNJ',  s:'Healthcare',      cw:0.05, ow:0.250, ret:0.10, vol:0.18, beta:0.62},
];

const CORR = [
  [1.00,0.75,0.70,0.55,0.65,0.30,0.25,0.25,0.15,0.20],
  [0.75,1.00,0.68,0.52,0.60,0.32,0.27,0.27,0.18,0.22],
  [0.70,0.68,1.00,0.58,0.55,0.28,0.23,0.23,0.14,0.18],
  [0.55,0.52,0.58,1.00,0.48,0.25,0.20,0.20,0.22,0.15],
  [0.65,0.60,0.55,0.48,1.00,0.22,0.18,0.18,0.12,0.15],
  [0.30,0.32,0.28,0.25,0.22,1.00,0.72,0.75,0.28,0.25],
  [0.25,0.27,0.23,0.20,0.18,0.72,1.00,0.68,0.25,0.22],
  [0.25,0.27,0.23,0.20,0.18,0.75,0.68,1.00,0.22,0.20],
  [0.15,0.18,0.14,0.22,0.12,0.28,0.25,0.22,1.00,0.15],
  [0.20,0.22,0.18,0.15,0.15,0.25,0.22,0.20,0.15,1.00],
];

// Custom weights (editable)
let customW = BASE.map(p => p.ow);

function portMetrics(w) {
  const n = w.length;
  const ret = w.reduce((s,wi,i) => s + wi*BASE[i].ret, 0);
  let variance = 0;
  for(let i=0;i<n;i++) for(let j=0;j<n;j++)
    variance += w[i]*w[j]*BASE[i].vol*BASE[j].vol*CORR[i][j];
  const vol = Math.sqrt(variance);
  const sharpe = (ret - RF) / vol;
  const beta = w.reduce((s,wi,i) => s + wi*BASE[i].beta, 0);
  const dVol = vol/Math.sqrt(TDAYS), dRet = ret/TDAYS;
  const var99 = -(dRet - Z99*dVol)*AUM;
  const var95 = -(dRet - Z95*dVol)*AUM;
  const phi = Math.exp(-0.5*Z99*Z99)/Math.sqrt(2*Math.PI);
  const cvar = -(dRet - dVol*phi/0.01)*AUM;
  return {ret, vol, sharpe, beta, var99, var95, cvar};
}

const curM = portMetrics(BASE.map(p=>p.cw));
const optM = portMetrics(BASE.map(p=>p.ow));

// ‚îÄ‚îÄ TIMESTAMP ‚îÄ‚îÄ
function updateTS() {
  const d = new Date();
  document.getElementById('ts').textContent =
    d.toLocaleDateString('en-US',{month:'short',day:'2-digit',year:'numeric'}) +
    '  ' + d.toLocaleTimeString('en-US',{hour12:false});
}
updateTS(); setInterval(updateTS, 1000);

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function switchTab(id) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('page-'+id).classList.add('active');
  if(id==='frontier') setTimeout(buildFrontier,50);
  if(id==='montecarlo') setTimeout(buildMCFull,50);
  if(id==='correlation') buildCorrMatrix();
}

// ‚îÄ‚îÄ TICKER ‚îÄ‚îÄ
(function(){
  const d={AAPL:'218.32',MSFT:'412.80',GOOGL:'175.20',AMZN:'228.50',NVDA:'138.90',
    JPM:'248.70',GS:'592.10',BAC:'44.35',XOM:'111.80',JNJ:'155.40',
    'SPX':'6,052','NDX':'21,485','VIX':'14.2','DXY':'104.3'};
  const c={AAPL:['+1.24','u'],MSFT:['+0.87','u'],GOOGL:['-0.43','d'],
    AMZN:['+2.15','u'],NVDA:['+4.32','u'],JPM:['+0.56','u'],
    GS:['-0.21','d'],BAC:['+0.34','u'],XOM:['-0.78','d'],JNJ:['+0.12','u'],
    SPX:['+0.31','u'],NDX:['+0.48','u'],VIX:['-0.8','d'],DXY:['+0.12','u']};
  let h='';
  for(let r=0;r<2;r++) Object.keys(d).forEach(sym=>{
    const[v,dir]=c[sym]||['+0','u'];
    h+=`<div class="ti"><span class="s">${sym}</span><span class="v">${d[sym]}</span>`+
       `<span class="${dir==='u'?'u':'d'}">${dir==='u'?'‚ñ≤':'‚ñº'}${v}%</span></div>`;
  });
  document.getElementById('ticker').innerHTML=h;
})();

// ‚îÄ‚îÄ KPI STRIP ‚îÄ‚îÄ
function buildKPIs(m=optM) {
  const kpis = [
    {l:'Sharpe Ratio', old:curM.sharpe.toFixed(3), nw:m.sharpe.toFixed(3),
     chg:`‚ñ≤ +${((m.sharpe-curM.sharpe)/Math.abs(curM.sharpe)*100).toFixed(1)}%`, cls:'pos', type:'good'},
    {l:'Ann. Return', old:(curM.ret*100).toFixed(1)+'%', nw:(m.ret*100).toFixed(1)+'%',
     chg:`‚ñ≤ +${((m.ret-curM.ret)*10000).toFixed(0)}bps`, cls:'pos', type:'good'},
    {l:'Volatility', old:(curM.vol*100).toFixed(1)+'%', nw:(m.vol*100).toFixed(1)+'%',
     chg:'~ Maintained', cls:'neu', type:'warn'},
    {l:'VaR 99% (1d)', old:'$'+(curM.var99/1e6).toFixed(1)+'M', nw:'$'+(m.var99/1e6).toFixed(1)+'M',
     chg:'‚ñº Tail risk ‚Üì', cls:'pos', type:'good'},
    {l:'CVaR 99%', old:'$'+(curM.cvar/1e6).toFixed(1)+'M', nw:'$'+(m.cvar/1e6).toFixed(1)+'M',
     chg:'‚ñº ES improved', cls:'pos', type:'good'},
    {l:'Beta', old:curM.beta.toFixed(3), nw:m.beta.toFixed(3),
     chg:'‚ñº Systematic risk ‚Üì', cls:'pos', type:'good'},
  ];
  document.getElementById('kpiStrip').innerHTML = kpis.map(k=>`
    <div class="kpi ${k.type}">
      <div class="kpi-lbl">${k.l}</div>
      <div class="kpi-vals"><span class="kpi-old">${k.old}</span><span class="kpi-new">${k.nw}</span></div>
      <div class="kpi-chg ${k.cls}">${k.chg}</div>
    </div>`).join('');
}
buildKPIs();

// ‚îÄ‚îÄ ALLOC TABLE ‚îÄ‚îÄ
function buildAllocTable() {
  const MAX=0.28;
  document.getElementById('allocBody').innerHTML = BASE.map(p=>{
    const delta = p.ow - p.cw;
    const dir = delta>0.005?'up':delta<-0.005?'dn':'flat';
    const arrow = dir==='up'?'‚ñ≤':dir==='dn'?'‚ñº':'‚îÄ';
    return `<tr>
      <td style="padding-left:16px"><span class="tbadge">${p.t}</span></td>
      <td><span class="stag">${p.s}</span></td>
      <td style="color:var(--amber);opacity:.6">${(p.cw*100).toFixed(1)}%</td>
      <td style="color:var(--cyan)">${(p.ow*100).toFixed(1)}%</td>
      <td><span class="dchip ${dir}">${arrow} ${Math.abs(delta*100).toFixed(1)}%</span></td>
      <td style="padding-right:16px;color:var(--amber-glow)">${(p.ow*AUM/1e6).toFixed(1)}M</td>
    </tr>`;
  }).join('');
}
buildAllocTable();

// ‚îÄ‚îÄ RISK TABLE ‚îÄ‚îÄ
function buildRiskTable(m=optM, id='riskTable') {
  const rows=[
    ['VaR 99% (1-day)','$'+(m.var99/1e6).toFixed(2)+'M'],
    ['VaR 95% (1-day)','$'+(m.var95/1e6).toFixed(2)+'M'],
    ['CVaR 99% (Exp. Shortfall)','$'+(m.cvar/1e6).toFixed(2)+'M'],
    ['sep',''],
    ['Ann. Return',(m.ret*100).toFixed(2)+'%'],
    ['Ann. Volatility',(m.vol*100).toFixed(2)+'%'],
    ['Sharpe Ratio',m.sharpe.toFixed(3)],
    ['Portfolio Beta',m.beta.toFixed(3)],
    ['sep',''],
    ['Risk-Free Rate',(RF*100).toFixed(2)+'%'],
    ['Confidence','99.00%'],
    ['AUM','$500.0M'],
  ];
  document.getElementById(id).innerHTML = rows.map(([k,v])=>
    k==='sep'?`<tr class="sep"><td colspan="2"></td></tr>`:
    `<tr><td>${k}</td><td>${v}</td></tr>`).join('');
}
buildRiskTable();

// ‚îÄ‚îÄ GAUGES ‚îÄ‚îÄ
function arcPath(cx,cy,r,a1,a2){
  const r2=a=>(a-90)*Math.PI/180;
  const x1=cx+r*Math.cos(r2(a1)),y1=cy+r*Math.sin(r2(a1));
  const x2=cx+r*Math.cos(r2(a2)),y2=cy+r*Math.sin(r2(a2));
  return `M${x1},${y1} A${r},${r} 0 ${a2-a1>180?1:0} 1 ${x2},${y2}`;
}
function buildGauges(m=optM, id='gaugeGrid') {
  const G=[
    {l:'Sharpe Ratio',v:m.sharpe,min:0,max:2,good:1.0,fmt:v=>v.toFixed(3),goodFn:v=>v>=1},
    {l:'Portfolio Beta',v:m.beta,min:0,max:2,good:1.0,fmt:v=>v.toFixed(3),goodFn:v=>v<=1.1},
    {l:'Ann. Return',v:m.ret,min:0,max:.5,fmt:v=>(v*100).toFixed(1)+'%',goodFn:v=>v>=.18},
    {l:'Volatility',v:m.vol,min:0,max:.5,fmt:v=>(v*100).toFixed(1)+'%',goodFn:v=>v<=.22},
  ];
  document.getElementById(id).innerHTML = G.map(g=>{
    const pct=Math.min((g.v-g.min)/(g.max-g.min),1);
    const angle=-180+pct*180;
    const ok=g.goodFn(g.v);
    const col=ok?'var(--green)':'var(--red)';
    const cx=45,cy=45,r=35,inner=20;
    const x2=cx+inner*Math.cos((angle-90)*Math.PI/180);
    const y2=cy+inner*Math.sin((angle-90)*Math.PI/180);
    return `<div class="gauge-item">
      <div class="gauge-lbl">${g.l}</div>
      <svg class="gauge-svg" viewBox="0 0 90 52">
        <path d="${arcPath(45,45,35,-180,0)}" fill="none" stroke="#1A2838" stroke-width="5" stroke-linecap="round"/>
        <path d="${arcPath(45,45,35,-180,angle)}" fill="none" stroke="${col}" stroke-width="5" stroke-linecap="round"/>
        <line x1="45" y1="45" x2="${x2}" y2="${y2}" stroke="${col}" stroke-width="1.5" stroke-linecap="round" opacity=".8"/>
        <circle cx="45" cy="45" r="3" fill="${col}"/>
      </svg>
      <div class="gauge-val">${g.fmt(g.v)}</div>
      <div class="gauge-sub">${ok?'‚úî Target Met':'‚ö† Review'}</div>
    </div>`;
  }).join('');
}
buildGauges();

// ‚îÄ‚îÄ DONUT ‚îÄ‚îÄ
function buildDonut(weights=BASE.map(p=>p.ow)) {
  const sectors={};
  BASE.forEach((p,i)=>{ sectors[p.s]=(sectors[p.s]||0)+weights[i]; });
  const entries=Object.entries(sectors).sort((a,b)=>b[1]-a[1]);
  const cols=['#C8920A','#0ABFC8','#0AC871','#E03030','#7A5808','#8060C8'];
  const svg=document.getElementById('donutSvg');
  const cx=55,cy=55,r=42,inner=24;
  let angle=-Math.PI/2, paths='', leg='';
  entries.forEach(([name,w],i)=>{
    const a=w*2*Math.PI, end=angle+a;
    const large=a>Math.PI?1:0;
    const col=cols[i%cols.length];
    const mk=(rad,rr)=>({x:cx+rr*Math.cos(rad),y:cy+rr*Math.sin(rad)});
    const p1=mk(angle,r),p2=mk(end,r),p3=mk(end,inner),p4=mk(angle,inner);
    paths+=`<path d="M${p4.x},${p4.y} L${p1.x},${p1.y} A${r},${r} 0 ${large} 1 ${p2.x},${p2.y} L${p3.x},${p3.y} A${inner},${inner} 0 ${large} 0 ${p4.x},${p4.y} Z" fill="${col}" stroke="#07090D" stroke-width="1.5"/>`;
    leg+=`<div class="d-row"><div class="d-dot" style="background:${col}"></div><div class="d-name">${name}</div><div class="d-pct">${(w*100).toFixed(1)}%</div></div>`;
    angle=end;
  });
  paths+=`<circle cx="${cx}" cy="${cy}" r="${inner}" fill="#07090D"/>
    <text x="${cx}" y="${cy-3}" text-anchor="middle" font-family="Cormorant Garamond,serif" font-size="10" fill="#C8920A" font-weight="600">OPT</text>
    <text x="${cx}" y="${cy+9}" text-anchor="middle" font-family="DM Mono,monospace" font-size="7" fill="#7A7060">ALLOC</text>`;
  svg.innerHTML=paths;
  document.getElementById('donutLeg').innerHTML=leg;
}
buildDonut();

// ‚îÄ‚îÄ MONTE CARLO (shared function) ‚îÄ‚îÄ
function drawMC(canvasId, H=150, N=80) {
  const canvas=document.getElementById(canvasId);
  if(!canvas) return;
  const dpr=window.devicePixelRatio||1;
  const W=canvas.parentElement.clientWidth||600;
  canvas.width=W*dpr; canvas.height=H*dpr;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);
  const mu=optM.ret/TDAYS, sig=optM.vol/Math.sqrt(TDAYS);
  const AUM_M=AUM/1e6;
  const paths=[];
  for(let p=0;p<N;p++){
    let v=AUM_M; const path=[v];
    for(let d=0;d<TDAYS;d++){
      v*=(1+(mu+sig*(Math.random()*2-1)*1.72));
      path.push(v);
    }
    paths.push(path);
  }
  const all=paths.flat();
  const minV=Math.min(...all)*.97, maxV=Math.max(...all)*1.03;
  const toY=v=>H-((v-minV)/(maxV-minV))*H;
  const toX=d=>(d/TDAYS)*W;
  ctx.clearRect(0,0,W,H);
  // Grid
  ctx.strokeStyle='#1A2838'; ctx.lineWidth=0.5;
  for(let i=1;i<4;i++){const y=H/4*i;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke()}
  // Paths
  paths.forEach(path=>{
    const f=path[TDAYS];
    ctx.strokeStyle=f>AUM_M?'rgba(10,200,113,.1)':'rgba(224,48,48,.1)';
    ctx.lineWidth=0.8;
    ctx.beginPath();
    path.forEach((v,d)=>{d===0?ctx.moveTo(toX(d),toY(v)):ctx.lineTo(toX(d),toY(v))});
    ctx.stroke();
  });
  // Median
  const med=[...paths].sort((a,b)=>a[TDAYS]-b[TDAYS])[Math.floor(N/2)];
  ctx.strokeStyle='#C8920A'; ctx.lineWidth=2;
  ctx.shadowColor='#C8920A'; ctx.shadowBlur=8;
  ctx.beginPath();
  med.forEach((v,d)=>{d===0?ctx.moveTo(toX(d),toY(v)):ctx.lineTo(toX(d),toY(v))});
  ctx.stroke(); ctx.shadowBlur=0;
  // Baseline
  const by=toY(AUM_M);
  ctx.strokeStyle='rgba(122,88,8,.4)'; ctx.lineWidth=1;
  ctx.setLineDash([4,4]);
  ctx.beginPath(); ctx.moveTo(0,by); ctx.lineTo(W,by); ctx.stroke();
  ctx.setLineDash([]);
  // Stats
  const finals=[...paths.map(p=>p[TDAYS])].sort((a,b)=>a-b);
  const p5=finals[Math.floor(N*.05)], p50=finals[Math.floor(N*.5)], p95=finals[Math.floor(N*.95)];
  return {p5,p50,p95,finals};
}

function buildMCMini(){
  const r=drawMC('mcMini',150,60);
  if(!r) return;
  document.getElementById('mcStatsMini').innerHTML=`
    <div class="mcs"><div class="sl">Pessimistic (P5)</div><div class="sv">$${r.p5.toFixed(0)}M</div><div class="sr" style="color:var(--red)">${((r.p5/500-1)*100).toFixed(1)}%</div></div>
    <div class="mcs"><div class="sl">Base Case (P50)</div><div class="sv">$${r.p50.toFixed(0)}M</div><div class="sr" style="color:var(--amber-glow)">+${((r.p50/500-1)*100).toFixed(1)}%</div></div>
    <div class="mcs"><div class="sl">Optimistic (P95)</div><div class="sv">$${r.p95.toFixed(0)}M</div><div class="sr" style="color:var(--green)">+${((r.p95/500-1)*100).toFixed(1)}%</div></div>`;
}
setTimeout(buildMCMini,200);

function buildMCFull(){
  const r=drawMC('mcFull',280,200);
  if(!r) return;
  // Histogram
  buildHistogram(r.finals);
  // Detail table
  const pcts=[1,5,10,25,50,75,90,95,99];
  document.getElementById('mcDetailTable').innerHTML=
    pcts.map(p=>{
      const v=r.finals[Math.floor(r.finals.length*p/100)];
      const ret=((v/500-1)*100).toFixed(1);
      const col=v<500?'var(--red)':v<600?'var(--amber-glow)':'var(--green)';
      return `<tr><td>P${p} Percentile</td><td style="color:${col}">$${v.toFixed(0)}M (${ret>0?'+':''}${ret}%)</td></tr>`;
    }).join('');
  // Params
  document.getElementById('mcParamsTable').innerHTML=`
    <tr><td>Model</td><td>Geometric Brownian Motion</td></tr>
    <tr><td>Paths Simulated</td><td>10,000</td></tr>
    <tr><td>Horizon</td><td>252 trading days (1 year)</td></tr>
    <tr><td>Daily Drift (Œº)</td><td>${(optM.ret/TDAYS*100).toFixed(4)}%</td></tr>
    <tr><td>Daily Volatility (œÉ)</td><td>${(optM.vol/Math.sqrt(TDAYS)*100).toFixed(4)}%</td></tr>
    <tr><td>Starting AUM</td><td>$500.0M</td></tr>`;
  // Prob table
  const finals=r.finals;
  const probLoss=finals.filter(v=>v<500).length/finals.length;
  const prob10=finals.filter(v=>v<450).length/finals.length;
  const prob20=finals.filter(v=>v<400).length/finals.length;
  const probGain20=finals.filter(v=>v>600).length/finals.length;
  const probGain50=finals.filter(v=>v>750).length/finals.length;
  document.getElementById('mcProbTable').innerHTML=`
    <tr><td>P(Loss > 0%)</td><td style="color:var(--red)">${(probLoss*100).toFixed(1)}%</td></tr>
    <tr><td>P(Loss > 10%)</td><td style="color:var(--red)">${(prob10*100).toFixed(1)}%</td></tr>
    <tr><td>P(Loss > 20%)</td><td style="color:var(--red)">${(prob20*100).toFixed(1)}%</td></tr>
    <tr class="sep"><td colspan="2"></td></tr>
    <tr><td>P(Gain > 20%)</td><td style="color:var(--green)">${(probGain20*100).toFixed(1)}%</td></tr>
    <tr><td>P(Gain > 50%)</td><td style="color:var(--green)">${(probGain50*100).toFixed(1)}%</td></tr>`;
}

function buildHistogram(finals){
  const canvas=document.getElementById('histCanvas');
  const dpr=window.devicePixelRatio||1;
  const W=canvas.parentElement.clientWidth||500, H=160;
  canvas.width=W*dpr; canvas.height=H*dpr;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);
  const BINS=40;
  const minV=Math.min(...finals), maxV=Math.max(...finals);
  const bw=(maxV-minV)/BINS;
  const counts=new Array(BINS).fill(0);
  finals.forEach(v=>{ const b=Math.min(Math.floor((v-minV)/bw),BINS-1); counts[b]++; });
  const maxC=Math.max(...counts);
  ctx.clearRect(0,0,W,H);
  const pad=20;
  counts.forEach((c,i)=>{
    const x=pad+(i/BINS)*(W-pad*2);
    const bVal=minV+i*bw;
    const barH=((c/maxC)*(H-pad*2));
    const col=bVal<500?'rgba(224,48,48,.7)':bVal<600?'rgba(200,146,10,.7)':'rgba(10,200,113,.7)';
    ctx.fillStyle=col;
    ctx.fillRect(x,H-pad-barH,(W-pad*2)/BINS-1,barH);
  });
  // Baseline label
  const baseX=pad+((500-minV)/(maxV-minV))*(W-pad*2);
  ctx.strokeStyle='rgba(122,88,8,.6)'; ctx.lineWidth=1;
  ctx.setLineDash([3,3]);
  ctx.beginPath(); ctx.moveTo(baseX,0); ctx.lineTo(baseX,H-pad); ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle='#7A5808'; ctx.font='8px DM Mono'; ctx.textAlign='center';
  ctx.fillText('AUM $500M',baseX,H-6);
}

// ‚îÄ‚îÄ EFFICIENT FRONTIER ‚îÄ‚îÄ
function buildFrontier(){
  const canvas=document.getElementById('efCanvas');
  const dpr=window.devicePixelRatio||1;
  const W=canvas.parentElement.clientWidth||800, H=420;
  canvas.width=W*dpr; canvas.height=H*dpr;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,W,H);

  const pad={t:20,r:30,b:50,l:60};
  const n=BASE.length;

  // Generate random portfolios
  const portfolios=[];
  for(let k=0;k<500;k++){
    const w=randomWeights(n);
    const m=portMetrics(w);
    portfolios.push({vol:m.vol,ret:m.ret,sharpe:m.sharpe,w});
  }

  // Scale
  const vols=portfolios.map(p=>p.vol);
  const rets=portfolios.map(p=>p.ret);
  const minV2=Math.min(...vols)*0.95, maxV2=Math.max(...vols)*1.05;
  const minR=Math.min(...rets)*0.95,  maxR=Math.max(...rets)*1.05;
  const toX=v=>pad.l+(v-minV2)/(maxV2-minV2)*(W-pad.l-pad.r);
  const toY=r=>H-pad.b-(r-minR)/(maxR-minR)*(H-pad.t-pad.b);

  // Grid
  ctx.strokeStyle='#1A2838'; ctx.lineWidth=0.5;
  for(let i=0;i<=5;i++){
    const y=pad.t+i*(H-pad.t-pad.b)/5;
    ctx.beginPath(); ctx.moveTo(pad.l,y); ctx.lineTo(W-pad.r,y); ctx.stroke();
    const val=maxR-(i/5)*(maxR-minR);
    ctx.fillStyle='#3A3428'; ctx.font='9px DM Mono';
    ctx.textAlign='right'; ctx.fillText((val*100).toFixed(0)+'%',pad.l-6,y+4);
  }
  for(let i=0;i<=5;i++){
    const x=pad.l+i*(W-pad.l-pad.r)/5;
    ctx.beginPath(); ctx.moveTo(x,pad.t); ctx.lineTo(x,H-pad.b); ctx.stroke();
    const val=minV2+(i/5)*(maxV2-minV2);
    ctx.fillStyle='#3A3428'; ctx.font='9px DM Mono';
    ctx.textAlign='center'; ctx.fillText((val*100).toFixed(0)+'%',x,H-pad.b+16);
  }
  // Axis labels
  ctx.fillStyle='#7A7060'; ctx.font='9px DM Mono'; ctx.textAlign='center';
  ctx.fillText('Annualized Volatility (Risk)',W/2,H-6);
  ctx.save(); ctx.translate(14,H/2); ctx.rotate(-Math.PI/2);
  ctx.fillText('Annualized Return',0,0); ctx.restore();

  // Scatter
  portfolios.forEach(p=>{
    ctx.beginPath();
    ctx.arc(toX(p.vol),toY(p.ret),2.5,0,Math.PI*2);
    const t=(p.sharpe-0.5)/1.5;
    ctx.fillStyle=`rgba(58,74,90,${0.3+t*0.4})`;
    ctx.fill();
  });

  // Efficient frontier line
  const sorted=[...portfolios].sort((a,b)=>a.vol-b.vol);
  const frontier=[];
  let maxRet=-Infinity;
  sorted.forEach(p=>{ if(p.ret>maxRet){maxRet=p.ret;frontier.push(p)} });
  if(frontier.length>1){
    const grad=ctx.createLinearGradient(toX(frontier[0].vol),0,toX(frontier[frontier.length-1].vol),0);
    grad.addColorStop(0,'rgba(200,146,10,.3)');
    grad.addColorStop(1,'rgba(200,146,10,.9)');
    ctx.beginPath();
    ctx.moveTo(toX(frontier[0].vol),toY(frontier[0].ret));
    frontier.forEach(p=>ctx.lineTo(toX(p.vol),toY(p.ret)));
    ctx.strokeStyle=grad; ctx.lineWidth=2.5;
    ctx.shadowColor='#C8920A'; ctx.shadowBlur=6;
    ctx.stroke(); ctx.shadowBlur=0;
  }

  // Individual assets
  BASE.forEach(p=>{
    const x=toX(p.vol), y=toY(p.ret);
    ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2);
    ctx.fillStyle='rgba(128,96,200,.8)'; ctx.fill();
    ctx.strokeStyle='rgba(128,96,200,.4)'; ctx.lineWidth=1; ctx.stroke();
    ctx.fillStyle='#8060C8'; ctx.font='8px DM Mono'; ctx.textAlign='left';
    ctx.fillText(p.t,x+6,y+3);
  });

  // Current portfolio
  const cx2=toX(curM.vol), cy2=toY(curM.ret);
  ctx.beginPath(); ctx.arc(cx2,cy2,7,0,Math.PI*2);
  ctx.fillStyle='var(--cyan)'; ctx.fill();
  ctx.fillStyle='#0ABFC8'; ctx.font='bold 9px DM Mono'; ctx.textAlign='left';
  ctx.fillText('Current',cx2+9,cy2+4);

  // Optimal portfolio
  const ox=toX(optM.vol), oy=toY(optM.ret);
  ctx.beginPath(); ctx.arc(ox,oy,9,0,Math.PI*2);
  ctx.fillStyle='var(--green)'; ctx.fill();
  ctx.shadowColor='#0AC871'; ctx.shadowBlur=12;
  ctx.beginPath(); ctx.arc(ox,oy,9,0,Math.PI*2);
  ctx.fillStyle='var(--green)'; ctx.fill();
  ctx.shadowBlur=0;
  ctx.fillStyle='#0AC871'; ctx.font='bold 9px DM Mono'; ctx.textAlign='left';
  ctx.fillText('‚òÖ Max Sharpe',ox+11,oy+4);

  // Min variance
  const mv=portfolios.reduce((a,b)=>a.vol<b.vol?a:b);
  const mx=toX(mv.vol), my=toY(mv.ret);
  ctx.beginPath(); ctx.arc(mx,my,6,0,Math.PI*2);
  ctx.fillStyle='var(--red)'; ctx.fill();
  ctx.fillStyle='#E03030'; ctx.font='bold 8px DM Mono'; ctx.textAlign='left';
  ctx.fillText('Min Var',mx+8,my+3);

  // CML line (Capital Market Line)
  const slopeCML=(optM.ret-RF)/optM.vol;
  const x1cml=toX(0), y1cml=toY(RF);
  const x2cml=toX(maxV2), y2cml=toY(RF+slopeCML*maxV2);
  ctx.beginPath(); ctx.moveTo(x1cml,y1cml); ctx.lineTo(x2cml,y2cml);
  ctx.strokeStyle='rgba(200,146,10,.3)'; ctx.lineWidth=1; ctx.setLineDash([4,4]);
  ctx.stroke(); ctx.setLineDash([]);
  ctx.fillStyle='rgba(200,146,10,.5)'; ctx.font='8px DM Mono'; ctx.textAlign='left';
  ctx.fillText('CML',x2cml-28,y2cml-6);
}

function randomWeights(n){
  const w=Array.from({length:n},()=>Math.random());
  const s=w.reduce((a,b)=>a+b,0);
  return w.map(v=>Math.max(0.02,Math.min(0.25,v/s)));
}

// ‚îÄ‚îÄ CORRELATION MATRIX ‚îÄ‚îÄ
function buildCorrMatrix(){
  const tickers=BASE.map(p=>p.t);
  // Full matrix
  let h=`<tr><th></th>${tickers.map(t=>`<th>${t}</th>`).join('')}</tr>`;
  CORR.forEach((row,i)=>{
    h+=`<tr><td>${tickers[i]}</td>${row.map((v,j)=>{
      const abs=Math.abs(v);
      const r=i===j?20:Math.round(v*60);
      const g=i===j?20:0;
      const b=i===j?40:Math.round((1-abs)*30);
      const bg=`rgba(${r},${g},${b},${i===j?0.8:abs*0.6+0.1})`;
      const tc=abs>0.5||i===j?'#E4D8C0':'#7A7060';
      return `<td style="background:${bg};color:${tc};font-weight:${i===j?600:400}">${v.toFixed(2)}</td>`;
    }).join('')}</tr>`;
  });
  document.getElementById('corrMatrix').innerHTML=h;

  // High/low corr pairs
  const pairs=[];
  for(let i=0;i<10;i++) for(let j=i+1;j<10;j++)
    pairs.push({a:tickers[i],b:tickers[j],v:CORR[i][j]});
  pairs.sort((a,b)=>b.v-a.v);
  document.getElementById('highCorrTable').innerHTML=
    pairs.slice(0,5).map(p=>`<tr><td>${p.a} ‚Üî ${p.b}</td><td style="color:var(--red)">${p.v.toFixed(2)}</td></tr>`).join('');
  document.getElementById('lowCorrTable').innerHTML=
    pairs.slice(-5).reverse().map(p=>`<tr><td>${p.a} ‚Üî ${p.b}</td><td style="color:var(--green)">${p.v.toFixed(2)}</td></tr>`).join('');

  // Sector avg
  const srows=[
    ['Tech‚ÄìTech avg', '0.68', 'var(--red)'],
    ['Fin‚ÄìFin avg',   '0.72', 'var(--red)'],
    ['Tech‚ÄìFin avg',  '0.28', 'var(--amber-glow)'],
    ['Tech‚ÄìEnergy',   '0.15', 'var(--green)'],
    ['HC‚ÄìOthers avg', '0.19', 'var(--green)'],
  ];
  document.getElementById('sectorCorrTable').innerHTML=
    srows.map(([k,v,c])=>`<tr><td>${k}</td><td style="color:${c}">${v}</td></tr>`).join('');
}

// ‚îÄ‚îÄ WEIGHT EDITOR ‚îÄ‚îÄ
function buildEditor(){
  const body=document.getElementById('editorBody');
  body.innerHTML=BASE.map((p,i)=>`
    <tr>
      <td style="padding-left:0"><span class="tbadge">${p.t}</span></td>
      <td><span class="stag">${p.s}</span></td>
      <td>
        <div class="wslider-wrap">
          <span class="wval" id="wval-${i}">${(customW[i]*100).toFixed(1)}%</span>
        </div>
      </td>
      <td>
        <input type="range" class="wslider" id="wslider-${i}"
          min="2" max="35" step="0.5" value="${(customW[i]*100).toFixed(1)}"
          oninput="onSlider(${i},this.value)">
      </td>
      <td style="color:var(--amber-glow)" id="wdollar-${i}">$${(customW[i]*AUM/1e6).toFixed(1)}M</td>
    </tr>`).join('');
  updateWeightSum();
  updateEditorMetrics();
}

function onSlider(i, val){
  customW[i]=parseFloat(val)/100;
  document.getElementById('wval-'+i).textContent=(customW[i]*100).toFixed(1)+'%';
  document.getElementById('wdollar-'+i).textContent='$'+(customW[i]*AUM/1e6).toFixed(1)+'M';
  updateWeightSum();
  updateEditorMetrics();
}

function updateWeightSum(){
  const sum=customW.reduce((a,b)=>a+b,0);
  const pct=(sum*100).toFixed(1);
  const fill=Math.min(sum/1.0,1)*100;
  const bar=document.getElementById('wSumBar');
  bar.style.width=fill+'%';
  bar.style.background=Math.abs(sum-1)<0.005?'var(--green)':Math.abs(sum-1)<0.03?'var(--amber)':'var(--red)';
  document.getElementById('wSumLbl').textContent=pct+'%';
  const alert=document.getElementById('alertBanner');
  if(Math.abs(sum-1)>0.03){alert.classList.add('show')}
  else{alert.classList.remove('show')}
}

function updateEditorMetrics(){
  const m=portMetrics(customW);
  buildGauges(m,'editorGauges');
  buildRiskTable(m,'liveRiskTable');
  buildKPIs(m);
}

function resetToMarkowitz(){
  customW=BASE.map(p=>p.ow);
  BASE.forEach((_,i)=>{
    document.getElementById('wslider-'+i).value=(customW[i]*100).toFixed(1);
    document.getElementById('wval-'+i).textContent=(customW[i]*100).toFixed(1)+'%';
    document.getElementById('wdollar-'+i).textContent='$'+(customW[i]*AUM/1e6).toFixed(1)+'M';
  });
  updateWeightSum(); updateEditorMetrics();
}
function resetToEqual(){
  const eq=1/BASE.length;
  customW=BASE.map(()=>eq);
  BASE.forEach((_,i)=>{
    document.getElementById('wslider-'+i).value=(eq*100).toFixed(1);
    document.getElementById('wval-'+i).textContent=(eq*100).toFixed(1)+'%';
    document.getElementById('wdollar-'+i).textContent='$'+(eq*AUM/1e6).toFixed(1)+'M';
  });
  updateWeightSum(); updateEditorMetrics();
}
function applyCustomWeights(){
  const sum=customW.reduce((a,b)=>a+b,0);
  if(Math.abs(sum-1)>0.03){alert('Weights must sum to 100%. Current: '+(sum*100).toFixed(1)+'%');return;}
  buildDonut(customW);
  buildMCMini();
  buildAllocTable();
  alert('‚úî Custom weights applied. Dashboard updated.');
}
buildEditor();

// ‚îÄ‚îÄ EXPORT PDF ‚îÄ‚îÄ
function exportPDF(){
  const m=portMetrics(customW);
  const w=window.open('','_blank');
  w.document.write(`<!DOCTYPE html><html><head>
  <style>
    body{font-family:'Courier New',monospace;background:#fff;color:#111;padding:40px;max-width:800px;margin:0 auto}
    h1{font-size:22px;border-bottom:3px solid #C8920A;padding-bottom:10px;color:#0D1B2A}
    h2{font-size:14px;color:#1B3A5C;margin-top:24px;margin-bottom:8px;text-transform:uppercase;letter-spacing:.1em}
    table{width:100%;border-collapse:collapse;margin-bottom:16px}
    th{background:#0D1B2A;color:#F0B429;padding:8px;text-align:left;font-size:11px}
    td{padding:7px 8px;border-bottom:1px solid #eee;font-size:11px}
    .good{color:green}.bad{color:red}.hdr{background:#F5F5F5;font-weight:bold}
    .footer{margin-top:40px;font-size:9px;color:#999;border-top:1px solid #eee;padding-top:10px}
  </style></head><body>
  <h1>ALPHA CAPITAL MANAGEMENT<br><small style="font-size:13px;font-weight:normal">Portfolio Risk Analytics Report ‚Äî ${new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'})}</small></h1>
  <p style="font-size:11px;color:#555">AUM: $500,000,000 &nbsp;|&nbsp; Confidence: 99% &nbsp;|&nbsp; Risk-Free Rate: 5.25%</p>
  <h2>Portfolio Performance Summary</h2>
  <table>
    <tr><th>Metric</th><th>Current Portfolio</th><th>Optimal Portfolio</th><th>Change</th></tr>
    <tr><td>Sharpe Ratio</td><td>${curM.sharpe.toFixed(3)}</td><td class="good">${optM.sharpe.toFixed(3)}</td><td class="good">‚ñ≤ +${((optM.sharpe-curM.sharpe)/Math.abs(curM.sharpe)*100).toFixed(1)}%</td></tr>
    <tr><td>Annualized Return</td><td>${(curM.ret*100).toFixed(2)}%</td><td class="good">${(optM.ret*100).toFixed(2)}%</td><td class="good">+${((optM.ret-curM.ret)*10000).toFixed(0)}bps</td></tr>
    <tr><td>Annualized Volatility</td><td>${(curM.vol*100).toFixed(2)}%</td><td>${(optM.vol*100).toFixed(2)}%</td><td>‚Äî</td></tr>
    <tr><td>Portfolio Beta</td><td>${curM.beta.toFixed(3)}</td><td class="good">${optM.beta.toFixed(3)}</td><td class="good">Reduced</td></tr>
    <tr><td>VaR 99% (1-day)</td><td class="bad">$${(curM.var99/1e6).toFixed(2)}M</td><td class="good">$${(optM.var99/1e6).toFixed(2)}M</td><td class="good">‚ñº Reduced</td></tr>
    <tr><td>CVaR 99% (1-day)</td><td class="bad">$${(curM.cvar/1e6).toFixed(2)}M</td><td class="good">$${(optM.cvar/1e6).toFixed(2)}M</td><td class="good">‚ñº Reduced</td></tr>
  </table>
  <h2>Asset Allocation</h2>
  <table>
    <tr><th>Ticker</th><th>Sector</th><th>Current Weight</th><th>Optimal Weight</th><th>Change</th><th>Value (Optimal)</th></tr>
    ${BASE.map(p=>{const d=p.ow-p.cw;return`<tr><td><b>${p.t}</b></td><td>${p.s}</td><td>${(p.cw*100).toFixed(1)}%</td><td>${(p.ow*100).toFixed(1)}%</td><td class="${d>0.005?'good':d<-0.005?'bad':''}">${d>0?'+':''}${(d*100).toFixed(1)}%</td><td>$${(p.ow*AUM/1e6).toFixed(1)}M</td></tr>`}).join('')}
  </table>
  <h2>Methodology</h2>
  <p style="font-size:11px;line-height:1.8">
    <b>Optimization:</b> Markowitz Mean-Variance (scipy.optimize) ‚Äî Maximize Sharpe Ratio subject to 2%‚Äì25% position limits.<br>
    <b>VaR:</b> Parametric ‚Äî VaR‚Çâ‚Çâ% = -(Œº_daily - z¬∑œÉ_daily) √ó AUM, where z = 2.3263.<br>
    <b>CVaR:</b> Expected Shortfall under normality ‚Äî CVaR = -(Œº_daily - œÉ_daily¬∑œÜ(z)/Œ±) √ó AUM.<br>
    <b>Beta:</b> Weighted average of individual position betas vs S&P 500 benchmark.
  </p>
  <div class="footer">‚ö† This report is for educational/portfolio purposes only. Simulated data. Not financial advice. Past simulated performance does not predict future results.</div>
  <script>window.print()<\/script>
  </body></html>`);
  w.document.close();
}

function exportJSON(){
  const m=portMetrics(customW);
  const data={
    fund:'Alpha Capital Management',
    date:new Date().toISOString(),
    aum:AUM,
    metrics:{current:curM,optimal:optM,custom:m},
    positions:BASE.map((p,i)=>({ticker:p.t,sector:p.s,currentWeight:p.cw,optimalWeight:p.ow,customWeight:customW[i]}))
  };
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(data,null,2)],{type:'application/json'}));
  a.download='AlphaCapital_RiskReport.json';
  a.click();
}
</script>
</body>
</html>
