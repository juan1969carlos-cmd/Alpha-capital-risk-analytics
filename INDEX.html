<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alpha Capital — Risk Analytics</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --void:       #080A0E;
    --surface:    #0D1117;
    --panel:      #111820;
    --border:     #1C2A38;
    --border2:    #243040;
    --amber:      #C8920A;
    --amber-dim:  #7A5808;
    --amber-glow: #F0B429;
    --amber-pale: #2A1E08;
    --cyan:       #0ABFC8;
    --cyan-dim:   #085E63;
    --green:      #0AC871;
    --green-dim:  #063D20;
    --red:        #C8300A;
    --red-dim:    #3D1206;
    --text-pri:   #E8DCC8;
    --text-sec:   #8A8070;
    --text-dim:   #4A4438;
    --white:      #F5F0E8;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { font-size: 14px; }

  body {
    background: var(--void);
    color: var(--text-pri);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
    cursor: crosshair;
  }

  /* ── SCANLINE OVERLAY ── */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.08) 2px,
      rgba(0,0,0,0.08) 4px
    );
    pointer-events: none;
    z-index: 9999;
  }

  /* ── NOISE GRAIN ── */
  body::after {
    content: '';
    position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9998;
    opacity: 0.6;
  }

  /* ─────── HEADER ─────── */
  .masthead {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    padding: 18px 32px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, #0C1018 0%, transparent 100%);
    position: sticky; top: 0; z-index: 100;
  }

  .masthead-left {
    display: flex; align-items: center; gap: 16px;
  }

  .logo-mark {
    width: 36px; height: 36px;
    border: 1.5px solid var(--amber);
    display: flex; align-items: center; justify-content: center;
    position: relative;
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    background: var(--amber-pale);
  }
  .logo-mark span {
    font-family: 'Cormorant Garamond', serif;
    font-size: 16px; font-weight: 700;
    color: var(--amber-glow);
  }

  .firm-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 19px; font-weight: 600;
    letter-spacing: 0.12em;
    color: var(--white);
    text-transform: uppercase;
  }
  .firm-tagline {
    font-size: 9px; letter-spacing: 0.25em;
    color: var(--text-sec);
    text-transform: uppercase; margin-top: 2px;
  }

  .masthead-center {
    text-align: center;
  }
  .module-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 11px; font-weight: 300; font-style: italic;
    letter-spacing: 0.3em;
    color: var(--amber-dim);
    text-transform: uppercase;
  }

  .masthead-right {
    display: flex; align-items: center; justify-content: flex-end; gap: 20px;
  }
  .live-badge {
    display: flex; align-items: center; gap: 6px;
    font-size: 9px; letter-spacing: 0.2em;
    color: var(--green); text-transform: uppercase;
  }
  .live-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--green);
    animation: pulse-dot 1.8s ease-in-out infinite;
  }
  @keyframes pulse-dot {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(10,200,113,0.4); }
    50% { opacity: 0.6; box-shadow: 0 0 0 4px rgba(10,200,113,0); }
  }

  .timestamp {
    font-size: 10px; color: var(--text-sec);
    letter-spacing: 0.08em;
  }

  /* ─────── TICKER TAPE ─────── */
  .ticker-wrap {
    background: var(--panel);
    border-bottom: 1px solid var(--border);
    overflow: hidden; padding: 7px 0;
  }
  .ticker-inner {
    display: flex; gap: 0;
    animation: ticker-scroll 40s linear infinite;
    width: max-content;
  }
  .ticker-inner:hover { animation-play-state: paused; }
  @keyframes ticker-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .ticker-item {
    display: flex; align-items: center; gap: 8px;
    padding: 0 24px;
    border-right: 1px solid var(--border);
    font-size: 10px; letter-spacing: 0.06em;
    white-space: nowrap;
  }
  .ticker-item .sym { color: var(--amber-glow); font-weight: 500; }
  .ticker-item .val { color: var(--text-pri); }
  .ticker-item .chg.up { color: var(--green); }
  .ticker-item .chg.dn { color: var(--red); }

  /* ─────── MAIN LAYOUT ─────── */
  .shell {
    max-width: 1440px; margin: 0 auto;
    padding: 24px 32px; display: flex; flex-direction: column; gap: 20px;
  }

  /* ─────── KPI STRIP ─────── */
  .kpi-strip {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
    animation: fadeUp 0.6s ease both;
  }
  .kpi-card {
    background: var(--surface);
    padding: 16px 18px;
    position: relative; overflow: hidden;
    cursor: default;
    transition: background 0.2s;
  }
  .kpi-card:hover { background: var(--panel); }
  .kpi-card::before {
    content: '';
    position: absolute; left: 0; top: 0; bottom: 0;
    width: 2px;
    background: var(--border2);
    transition: background 0.2s, width 0.2s;
  }
  .kpi-card:hover::before { background: var(--amber); width: 2px; }
  .kpi-card.improved::before { background: var(--green); }
  .kpi-card.degraded::before { background: var(--red); }

  .kpi-label {
    font-size: 8px; letter-spacing: 0.22em;
    color: var(--text-sec); text-transform: uppercase;
    margin-bottom: 8px;
  }
  .kpi-pair {
    display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap;
  }
  .kpi-cur {
    font-family: 'Cormorant Garamond', serif;
    font-size: 22px; font-weight: 300;
    color: var(--text-sec); line-height: 1;
    text-decoration: line-through;
    text-decoration-color: var(--border2);
  }
  .kpi-opt {
    font-family: 'Cormorant Garamond', serif;
    font-size: 28px; font-weight: 600;
    color: var(--amber-glow); line-height: 1;
  }
  .kpi-delta {
    font-size: 9px; letter-spacing: 0.1em;
    margin-top: 5px;
  }
  .kpi-delta.pos { color: var(--green); }
  .kpi-delta.neg { color: var(--red); }
  .kpi-delta.neu { color: var(--text-sec); }

  /* ─────── MAIN GRID ─────── */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 20px;
  }

  .col-left { display: flex; flex-direction: column; gap: 20px; }
  .col-right { display: flex; flex-direction: column; gap: 20px; }

  /* ─────── PANEL BASE ─────── */
  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    animation: fadeUp 0.6s ease both;
  }
  .panel-hdr {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 18px;
    border-bottom: 1px solid var(--border);
    background: var(--panel);
  }
  .panel-title {
    font-size: 9px; letter-spacing: 0.25em;
    color: var(--amber); text-transform: uppercase; font-weight: 500;
  }
  .panel-sub {
    font-size: 9px; color: var(--text-dim);
    letter-spacing: 0.1em;
  }
  .panel-body { padding: 18px; }

  /* ─────── ALLOCATION TABLE ─────── */
  .alloc-table { width: 100%; border-collapse: collapse; }
  .alloc-table thead tr {
    border-bottom: 1px solid var(--border2);
  }
  .alloc-table th {
    font-size: 8px; letter-spacing: 0.2em;
    color: var(--text-dim); text-transform: uppercase;
    padding: 0 8px 10px; text-align: right; font-weight: 400;
  }
  .alloc-table th:first-child { text-align: left; }
  .alloc-table th:nth-child(2) { text-align: left; }

  .alloc-table tbody tr {
    border-bottom: 1px solid rgba(28,42,56,0.5);
    transition: background 0.15s;
    cursor: default;
  }
  .alloc-table tbody tr:hover { background: rgba(200,146,10,0.04); }

  .alloc-table td {
    padding: 10px 8px; font-size: 11px;
    text-align: right; color: var(--text-sec);
  }
  .alloc-table td:first-child { text-align: left; }
  .alloc-table td:nth-child(2) { text-align: left; font-size: 10px; }

  .ticker-badge {
    font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 500;
    color: var(--amber-glow);
    letter-spacing: 0.05em;
  }
  .sector-tag {
    font-size: 9px; color: var(--text-dim);
    letter-spacing: 0.08em;
  }

  .weight-bar-wrap {
    display: flex; align-items: center; gap: 8px;
  }
  .weight-bar-bg {
    flex: 1; height: 3px;
    background: var(--border2); border-radius: 2px;
    position: relative;
  }
  .weight-bar-fill {
    position: absolute; left: 0; top: 0; bottom: 0;
    border-radius: 2px;
    transition: width 1.2s cubic-bezier(0.16,1,0.3,1);
  }
  .weight-bar-fill.cur { background: var(--amber-dim); }
  .weight-bar-fill.opt { background: var(--amber-glow); }

  .delta-chip {
    display: inline-flex; align-items: center;
    padding: 2px 6px;
    font-size: 9px; font-weight: 500;
    letter-spacing: 0.06em; border-radius: 2px;
  }
  .delta-chip.up { background: var(--green-dim); color: var(--green); }
  .delta-chip.dn { background: var(--red-dim); color: var(--red); }
  .delta-chip.flat { background: var(--border); color: var(--text-dim); }

  /* ─────── BAR CHART ─────── */
  .bar-chart { display: flex; flex-direction: column; gap: 10px; }
  .bar-row { display: flex; align-items: center; gap: 12px; }
  .bar-label {
    width: 48px; font-size: 10px;
    color: var(--amber-glow); text-align: right;
    font-weight: 500; flex-shrink: 0;
  }
  .bar-track {
    flex: 1; height: 22px;
    background: var(--panel); border: 1px solid var(--border);
    position: relative; overflow: hidden;
  }
  .bar-fill-cur {
    position: absolute; left: 0; top: 2px;
    height: 8px;
    background: linear-gradient(90deg, var(--amber-dim), var(--amber));
    transition: width 1.4s cubic-bezier(0.16,1,0.3,1);
    opacity: 0.6;
  }
  .bar-fill-opt {
    position: absolute; left: 0; bottom: 2px;
    height: 8px;
    background: linear-gradient(90deg, var(--cyan-dim), var(--cyan));
    transition: width 1.4s cubic-bezier(0.16,1,0.3,1) 0.15s;
  }
  .bar-val {
    width: 48px; font-size: 10px;
    color: var(--text-sec); text-align: left; flex-shrink: 0;
  }

  /* ─────── RISK GAUGES ─────── */
  .gauge-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

  .gauge-item {
    background: var(--panel);
    border: 1px solid var(--border);
    padding: 16px;
    text-align: center;
  }
  .gauge-label {
    font-size: 8px; letter-spacing: 0.22em;
    color: var(--text-dim); text-transform: uppercase;
    margin-bottom: 12px;
  }
  .gauge-svg { width: 100px; height: 60px; margin: 0 auto 8px; display: block; }
  .gauge-val {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px; font-weight: 600;
    color: var(--amber-glow);
  }
  .gauge-sublabel {
    font-size: 9px; color: var(--text-sec);
    margin-top: 3px; letter-spacing: 0.08em;
  }

  /* ─────── MONTE CARLO ─────── */
  .mc-viz {
    position: relative; height: 140px;
    margin-bottom: 16px;
  }
  .mc-canvas { width: 100%; height: 100%; }

  .mc-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1px; background: var(--border); }
  .mc-stat {
    background: var(--panel);
    padding: 12px; text-align: center;
  }
  .mc-stat .s-label { font-size: 8px; letter-spacing: 0.2em; color: var(--text-dim); text-transform: uppercase; }
  .mc-stat .s-val {
    font-family: 'Cormorant Garamond', serif;
    font-size: 18px; font-weight: 600; margin-top: 4px;
  }
  .mc-stat .s-ret { font-size: 9px; margin-top: 2px; }
  .mc-stat:nth-child(1) .s-val { color: var(--red); }
  .mc-stat:nth-child(2) .s-val { color: var(--amber-glow); }
  .mc-stat:nth-child(3) .s-val { color: var(--green); }

  /* ─────── SECTOR DONUT ─────── */
  .donut-wrap {
    display: flex; align-items: center; gap: 20px;
  }
  .donut-svg { width: 120px; height: 120px; flex-shrink: 0; }
  .donut-legend { flex: 1; display: flex; flex-direction: column; gap: 8px; }
  .legend-row { display: flex; align-items: center; gap: 8px; }
  .legend-dot { width: 8px; height: 8px; border-radius: 1px; flex-shrink: 0; }
  .legend-name { font-size: 10px; color: var(--text-sec); flex: 1; }
  .legend-pct {
    font-size: 10px; color: var(--amber-glow); font-weight: 500;
    letter-spacing: 0.05em;
  }

  /* ─────── RISK TABLE ─────── */
  .risk-table { width: 100%; border-collapse: collapse; }
  .risk-table tr { border-bottom: 1px solid rgba(28,42,56,0.6); }
  .risk-table tr:last-child { border-bottom: none; }
  .risk-table td { padding: 9px 0; font-size: 10px; }
  .risk-table td:first-child { color: var(--text-sec); letter-spacing: 0.06em; }
  .risk-table td:last-child { text-align: right; color: var(--amber-glow); font-weight: 500; }
  .risk-table .risk-sep { height: 1px; background: var(--border); padding: 0; }

  /* ─────── REBALANCE BTN ─────── */
  .action-btn {
    width: 100%;
    padding: 13px;
    background: transparent;
    border: 1px solid var(--amber-dim);
    color: var(--amber);
    font-family: 'DM Mono', monospace;
    font-size: 10px; letter-spacing: 0.25em;
    text-transform: uppercase;
    cursor: pointer;
    position: relative; overflow: hidden;
    transition: all 0.2s;
  }
  .action-btn::before {
    content: '';
    position: absolute; left: -100%; top: 0;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(200,146,10,0.08), transparent);
    transition: left 0.4s;
  }
  .action-btn:hover {
    border-color: var(--amber);
    color: var(--amber-glow);
    box-shadow: 0 0 20px rgba(200,146,10,0.1);
  }
  .action-btn:hover::before { left: 100%; }

  .action-btn.exec {
    border-color: var(--green);
    color: var(--green);
  }
  .action-btn.exec:hover {
    box-shadow: 0 0 20px rgba(10,200,113,0.1);
  }
  .action-btn.exec::before {
    background: linear-gradient(90deg, transparent, rgba(10,200,113,0.08), transparent);
  }

  /* ─────── FOOTER ─────── */
  .footer {
    padding: 16px 32px;
    border-top: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
    background: var(--panel);
  }
  .footer-note { font-size: 9px; color: var(--text-dim); letter-spacing: 0.1em; }
  .footer-stack { display: flex; gap: 16px; }
  .stack-badge {
    font-size: 9px; letter-spacing: 0.15em;
    color: var(--text-dim); text-transform: uppercase;
    padding: 3px 8px; border: 1px solid var(--border);
  }

  /* ─────── ANIMATIONS ─────── */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .panel:nth-child(1) { animation-delay: 0.05s; }
  .panel:nth-child(2) { animation-delay: 0.10s; }
  .panel:nth-child(3) { animation-delay: 0.15s; }
  .panel:nth-child(4) { animation-delay: 0.20s; }

  .kpi-strip { animation-delay: 0.02s; }

  /* ─────── SCROLLBAR ─────── */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--void); }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--amber-dim); }

  /* ─────── RESPONSIVE ─────── */
  @media (max-width: 1100px) {
    .main-grid { grid-template-columns: 1fr; }
    .kpi-strip { grid-template-columns: repeat(3, 1fr); }
  }
  @media (max-width: 700px) {
    .kpi-strip { grid-template-columns: repeat(2, 1fr); }
    .shell { padding: 16px; }
    .masthead { padding: 12px 16px; }
    .gauge-grid { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<!-- ══ HEADER ══ -->
<header class="masthead">
  <div class="masthead-left">
    <div class="logo-mark"><span>α</span></div>
    <div>
      <div class="firm-name">Alpha Capital</div>
      <div class="firm-tagline">Management · Long/Short Equity · $500M AUM</div>
    </div>
  </div>
  <div class="masthead-center">
    <div class="module-title">Portfolio Risk Analytics System</div>
  </div>
  <div class="masthead-right">
    <div class="live-badge"><div class="live-dot"></div>LIVE</div>
    <div class="timestamp" id="ts">—</div>
  </div>
</header>

<!-- ══ TICKER TAPE ══ -->
<div class="ticker-wrap">
  <div class="ticker-inner" id="ticker"></div>
</div>

<!-- ══ MAIN SHELL ══ -->
<main class="shell">

  <!-- KPI Strip -->
  <div class="kpi-strip" id="kpiStrip"></div>

  <!-- Main Grid -->
  <div class="main-grid">

    <!-- LEFT COLUMN -->
    <div class="col-left">

      <!-- Allocation Table -->
      <div class="panel">
        <div class="panel-hdr">
          <span class="panel-title">Asset Allocation Matrix</span>
          <span class="panel-sub">CURRENT → MARKOWITZ OPTIMAL</span>
        </div>
        <div class="panel-body" style="padding:0;">
          <table class="alloc-table" id="allocTable">
            <thead>
              <tr>
                <th style="padding-left:18px">Ticker</th>
                <th>Sector</th>
                <th>Current</th>
                <th>Optimal</th>
                <th>Δ Change</th>
                <th style="padding-right:18px">Value ($M)</th>
              </tr>
            </thead>
            <tbody id="allocBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Comparative Bar Chart -->
      <div class="panel">
        <div class="panel-hdr">
          <span class="panel-title">Weight Distribution</span>
          <span class="panel-sub">
            <span style="color:var(--amber);opacity:.6">■</span> CURRENT &nbsp;
            <span style="color:var(--cyan)">■</span> OPTIMAL
          </span>
        </div>
        <div class="panel-body">
          <div class="bar-chart" id="barChart"></div>
        </div>
      </div>

    </div>

    <!-- RIGHT COLUMN -->
    <div class="col-right">

      <!-- Risk Gauges -->
      <div class="panel">
        <div class="panel-hdr">
          <span class="panel-title">Risk Gauges</span>
          <span class="panel-sub">OPTIMAL PORTFOLIO</span>
        </div>
        <div class="panel-body">
          <div class="gauge-grid" id="gaugeGrid"></div>
        </div>
      </div>

      <!-- Sector Donut -->
      <div class="panel">
        <div class="panel-hdr">
          <span class="panel-title">Sector Concentration</span>
          <span class="panel-sub">OPTIMAL WEIGHTS</span>
        </div>
        <div class="panel-body">
          <div class="donut-wrap">
            <svg class="donut-svg" viewBox="0 0 120 120" id="donutSvg"></svg>
            <div class="donut-legend" id="donutLegend"></div>
          </div>
        </div>
      </div>

      <!-- Monte Carlo -->
      <div class="panel">
        <div class="panel-hdr">
          <span class="panel-title">Monte Carlo Simulation</span>
          <span class="panel-sub">10,000 SCENARIOS · 12 MONTHS</span>
        </div>
        <div class="panel-body">
          <div class="mc-viz">
            <canvas class="mc-canvas" id="mcCanvas"></canvas>
          </div>
          <div class="mc-stats" id="mcStats"></div>
        </div>
      </div>

      <!-- Risk Metrics -->
      <div class="panel">
        <div class="panel-hdr">
          <span class="panel-title">Regulatory Risk Metrics</span>
          <span class="panel-sub">99% CONFIDENCE · DAILY</span>
        </div>
        <div class="panel-body" style="padding: 12px 18px;">
          <table class="risk-table" id="riskTable"></table>
        </div>
      </div>

      <!-- Actions -->
      <div style="display:flex; flex-direction:column; gap:8px;">
        <button class="action-btn exec" onclick="rebalance()">
          ▶ Execute Rebalancing Order
        </button>
        <button class="action-btn" onclick="exportReport()">
          ↓ Export Risk Report
        </button>
      </div>

    </div>
  </div>
</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-note">
    ⚠ Simulated data for educational purposes only. Not financial advice.
    Model assumes normal distribution of returns. Past performance ≠ future results.
  </div>
  <div class="footer-stack">
    <span class="stack-badge">Python</span>
    <span class="stack-badge">JavaScript</span>
    <span class="stack-badge">Excel</span>
  </div>
</footer>

<script>
// ══════════════════════════════════════════════════════
//  DATA MODEL
// ══════════════════════════════════════════════════════
const AUM = 500e6;
const RF  = 0.0525;
const Z99 = 2.3263;

const positions = [
  {ticker:'AAPL', sector:'Technology',             curW:0.18, optW:0.250, ret:0.22, vol:0.28, beta:1.21},
  {ticker:'MSFT', sector:'Technology',             curW:0.15, optW:0.250, ret:0.20, vol:0.25, beta:1.15},
  {ticker:'GOOGL',sector:'Technology',             curW:0.12, optW:0.047, ret:0.18, vol:0.27, beta:1.12},
  {ticker:'AMZN', sector:'Consumer Disc.',         curW:0.10, optW:0.020, ret:0.25, vol:0.30, beta:1.28},
  {ticker:'NVDA', sector:'Technology',             curW:0.08, optW:0.103, ret:0.38, vol:0.45, beta:1.55},
  {ticker:'JPM',  sector:'Financials',             curW:0.12, optW:0.020, ret:0.14, vol:0.22, beta:1.05},
  {ticker:'GS',   sector:'Financials',             curW:0.08, optW:0.020, ret:0.16, vol:0.28, beta:1.18},
  {ticker:'BAC',  sector:'Financials',             curW:0.07, optW:0.020, ret:0.13, vol:0.25, beta:1.10},
  {ticker:'XOM',  sector:'Energy',                 curW:0.05, optW:0.020, ret:0.09, vol:0.30, beta:0.78},
  {ticker:'JNJ',  sector:'Healthcare',             curW:0.05, optW:0.250, ret:0.10, vol:0.18, beta:0.62},
];

// Correlation matrix (simplified diagonal approximation for JS)
const CORR = [
  [1.00,0.75,0.70,0.55,0.65,0.30,0.25,0.25,0.15,0.20],
  [0.75,1.00,0.68,0.52,0.60,0.32,0.27,0.27,0.18,0.22],
  [0.70,0.68,1.00,0.58,0.55,0.28,0.23,0.23,0.14,0.18],
  [0.55,0.52,0.58,1.00,0.48,0.25,0.20,0.20,0.22,0.15],
  [0.65,0.60,0.55,0.48,1.00,0.22,0.18,0.18,0.12,0.15],
  [0.30,0.32,0.28,0.25,0.22,1.00,0.72,0.75,0.28,0.25],
  [0.25,0.27,0.23,0.20,0.18,0.72,1.00,0.68,0.25,0.22],
  [0.25,0.27,0.23,0.20,0.18,0.75,0.68,1.00,0.22,0.20],
  [0.15,0.18,0.14,0.22,0.12,0.28,0.25,0.22,1.00,0.15],
  [0.20,0.22,0.18,0.15,0.15,0.25,0.22,0.20,0.15,1.00],
];

function portMetrics(weights) {
  const n = weights.length;
  const ret = weights.reduce((s,w,i)=>s+w*positions[i].ret, 0);
  let variance = 0;
  for (let i=0;i<n;i++) for (let j=0;j<n;j++) {
    variance += weights[i]*weights[j]*positions[i].vol*positions[j].vol*CORR[i][j];
  }
  const vol = Math.sqrt(variance);
  const sharpe = (ret - RF) / vol;
  const beta = weights.reduce((s,w,i)=>s+w*positions[i].beta,0);
  const dailyVol = vol / Math.sqrt(252);
  const dailyRet = ret / 252;
  const var99 = -(dailyRet - Z99*dailyVol)*AUM;
  const phi = Math.exp(-0.5*Z99*Z99)/Math.sqrt(2*Math.PI);
  const cvar = -(dailyRet - dailyVol*phi/0.01)*AUM;
  return {ret, vol, sharpe, beta, var99, cvar};
}

const curW = positions.map(p=>p.curW);
const optW = positions.map(p=>p.optW);
const cur  = portMetrics(curW);
const opt  = portMetrics(optW);

// ══════════════════════════════════════════════════════
//  TIMESTAMP
// ══════════════════════════════════════════════════════
function updateTS() {
  const d = new Date();
  document.getElementById('ts').textContent =
    d.toLocaleDateString('en-US',{month:'short',day:'2-digit',year:'numeric'}) +
    '  ' + d.toLocaleTimeString('en-US',{hour12:false});
}
updateTS(); setInterval(updateTS, 1000);

// ══════════════════════════════════════════════════════
//  TICKER TAPE
// ══════════════════════════════════════════════════════
function buildTicker() {
  const prices = {
    AAPL:'218.32',MSFT:'412.80',GOOGL:'175.20',AMZN:'228.50',
    NVDA:'138.90',JPM:'248.70',GS:'592.10',BAC:'44.35',
    XOM:'111.80',JNJ:'155.40','SPX':'6,052.3','NDX':'21,485','VIX':'14.2'
  };
  const changes = {
    AAPL:['+1.24','up'],MSFT:['+0.87','up'],GOOGL:['-0.43','dn'],
    AMZN:['+2.15','up'],NVDA:['+4.32','up'],JPM:['+0.56','up'],
    GS:['-0.21','dn'],BAC:['+0.34','up'],XOM:['-0.78','dn'],
    JNJ:['+0.12','up'],'SPX':['+0.31','up'],'NDX':['+0.48','up'],
    VIX:['-0.8','dn']
  };
  const el = document.getElementById('ticker');
  let html = '';
  const all = Object.keys(prices);
  // Duplicate for seamless scroll
  for (let rep=0; rep<2; rep++) {
    all.forEach(sym => {
      const [chg,dir] = changes[sym]||['+0.00','up'];
      html += `<div class="ticker-item">
        <span class="sym">${sym}</span>
        <span class="val">${prices[sym]}</span>
        <span class="chg ${dir}">${dir==='up'?'▲':'▼'}${chg}%</span>
      </div>`;
    });
  }
  el.innerHTML = html;
}
buildTicker();

// ══════════════════════════════════════════════════════
//  KPI STRIP
// ══════════════════════════════════════════════════════
const kpis = [
  {label:'Sharpe Ratio',  cur:cur.sharpe.toFixed(3), opt:opt.sharpe.toFixed(3),
   delta:`▲ +${((opt.sharpe-cur.sharpe)/Math.abs(cur.sharpe)*100).toFixed(1)}%`, cls:'pos', type:'improved'},
  {label:'Ann. Return',   cur:(cur.ret*100).toFixed(1)+'%', opt:(opt.ret*100).toFixed(1)+'%',
   delta:`▲ +${((opt.ret-cur.ret)*10000).toFixed(0)}bps`, cls:'pos', type:'improved'},
  {label:'Volatility',    cur:(cur.vol*100).toFixed(1)+'%', opt:(opt.vol*100).toFixed(1)+'%',
   delta:'~ Maintained', cls:'neu', type:''},
  {label:'VaR 99% (1d)',  cur:'$'+' '+(cur.var99/1e6).toFixed(1)+'M', opt:'$'+(opt.var99/1e6).toFixed(1)+'M',
   delta:'▼ Tail risk reduced', cls:'pos', type:'improved'},
  {label:'CVaR 99% (1d)', cur:'$'+(cur.cvar/1e6).toFixed(1)+'M', opt:'$'+(opt.cvar/1e6).toFixed(1)+'M',
   delta:'▼ ES improved', cls:'pos', type:'improved'},
  {label:'Portfolio Beta', cur:cur.beta.toFixed(3), opt:opt.beta.toFixed(3),
   delta:'▼ Less systematic risk', cls:'pos', type:'improved'},
];

document.getElementById('kpiStrip').innerHTML = kpis.map(k=>`
  <div class="kpi-card ${k.type}">
    <div class="kpi-label">${k.label}</div>
    <div class="kpi-pair">
      <div class="kpi-cur">${k.cur}</div>
      <div class="kpi-opt">${k.opt}</div>
    </div>
    <div class="kpi-delta ${k.cls}">${k.delta}</div>
  </div>`).join('');

// ══════════════════════════════════════════════════════
//  ALLOCATION TABLE
// ══════════════════════════════════════════════════════
function buildAllocTable() {
  const body = document.getElementById('allocBody');
  body.innerHTML = positions.map(p => {
    const delta = p.optW - p.curW;
    const dir = delta > 0.005 ? 'up' : (delta < -0.005 ? 'dn' : 'flat');
    const arrow = dir==='up' ? '▲' : (dir==='dn' ? '▼' : '─');
    const sign  = dir==='up' ? '+' : (dir==='dn' ? '' : '');
    return `<tr>
      <td style="padding-left:18px">
        <span class="ticker-badge">${p.ticker}</span>
      </td>
      <td><span class="sector-tag">${p.sector}</span></td>
      <td>
        <div class="weight-bar-wrap">
          <div class="weight-bar-bg" style="width:80px">
            <div class="weight-bar-fill cur" style="width:0%" data-w="${p.curW*100}"></div>
          </div>
          <span style="font-size:10px;color:var(--amber);opacity:.6;min-width:36px;text-align:right">
            ${(p.curW*100).toFixed(1)}%
          </span>
        </div>
      </td>
      <td>
        <div class="weight-bar-wrap">
          <div class="weight-bar-bg" style="width:80px">
            <div class="weight-bar-fill opt" style="width:0%" data-w="${p.optW*100}"></div>
          </div>
          <span style="font-size:10px;color:var(--cyan);min-width:36px;text-align:right">
            ${(p.optW*100).toFixed(1)}%
          </span>
        </div>
      </td>
      <td>
        <span class="delta-chip ${dir}">
          ${arrow} ${sign}${Math.abs(delta*100).toFixed(1)}%
        </span>
      </td>
      <td style="padding-right:18px;font-size:10px;color:var(--amber-glow)">
        $${(p.optW*AUM/1e6).toFixed(1)}M
      </td>
    </tr>`;
  }).join('');

  // Animate bars after a tick
  setTimeout(() => {
    const MAX = 25;
    document.querySelectorAll('.weight-bar-fill').forEach(el => {
      const w = parseFloat(el.dataset.w);
      el.style.width = (w/MAX*100) + '%';
    });
  }, 300);
}
buildAllocTable();

// ══════════════════════════════════════════════════════
//  BAR CHART
// ══════════════════════════════════════════════════════
function buildBarChart() {
  const container = document.getElementById('barChart');
  const MAX = 0.28;
  container.innerHTML = positions.map(p => `
    <div class="bar-row">
      <div class="bar-label">${p.ticker}</div>
      <div class="bar-track">
        <div class="bar-fill-cur" style="width:0%" data-w="${(p.curW/MAX*100).toFixed(1)}"></div>
        <div class="bar-fill-opt" style="width:0%" data-w="${(p.optW/MAX*100).toFixed(1)}"></div>
      </div>
      <div class="bar-val">${(p.optW*100).toFixed(1)}%</div>
    </div>`).join('');

  setTimeout(() => {
    document.querySelectorAll('.bar-fill-cur, .bar-fill-opt').forEach(el => {
      el.style.width = el.dataset.w + '%';
    });
  }, 400);
}
buildBarChart();

// ══════════════════════════════════════════════════════
//  RISK GAUGES (SVG arc)
// ══════════════════════════════════════════════════════
function arcPath(cx,cy,r,startAngle,endAngle) {
  const toRad = a => (a-90)*Math.PI/180;
  const x1 = cx + r*Math.cos(toRad(startAngle));
  const y1 = cy + r*Math.sin(toRad(startAngle));
  const x2 = cx + r*Math.cos(toRad(endAngle));
  const y2 = cy + r*Math.sin(toRad(endAngle));
  const large = (endAngle-startAngle)>180 ? 1 : 0;
  return `M ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2}`;
}

function buildGauges() {
  const gauges = [
    {label:'Sharpe Ratio', val:opt.sharpe, min:0, max:2,
     good:1.0, fmt: v=>v.toFixed(3)},
    {label:'Portfolio Beta', val:opt.beta, min:0, max:2,
     good:1.0, fmt: v=>v.toFixed(3)},
    {label:'Ann. Return', val:opt.ret, min:0, max:0.5,
     good:0.20, fmt: v=>(v*100).toFixed(1)+'%'},
    {label:'Ann. Volatility', val:opt.vol, min:0, max:0.5,
     good:0.20, fmt: v=>(v*100).toFixed(1)+'%'},
  ];

  document.getElementById('gaugeGrid').innerHTML = gauges.map(g => {
    const pct = Math.min((g.val-g.min)/(g.max-g.min), 1);
    const angle = -180 + pct*180;
    const isGood = g.label==='Sharpe Ratio' ? g.val>=g.good :
                   g.label==='Portfolio Beta' ? g.val<=g.good :
                   g.label==='Ann. Return' ? g.val>=g.good : g.val<=g.good;
    const color = isGood ? '#0AC871' : '#C8300A';

    return `<div class="gauge-item">
      <div class="gauge-label">${g.label}</div>
      <svg class="gauge-svg" viewBox="0 0 100 55">
        <path d="${arcPath(50,50,38,-180,0)}"
          fill="none" stroke="#1C2A38" stroke-width="6" stroke-linecap="round"/>
        <path d="${arcPath(50,50,38,-180,angle)}"
          fill="none" stroke="${color}" stroke-width="6" stroke-linecap="round"
          stroke-dasharray="200" stroke-dashoffset="200"
          style="animation: drawArc 1.2s ease forwards 0.5s">
        </path>
        <line x1="50" y1="50"
          x2="${50+32*Math.cos((angle-90)*Math.PI/180)}"
          y2="${50+32*Math.sin((angle-90)*Math.PI/180)}"
          stroke="${color}" stroke-width="1.5" stroke-linecap="round"
          opacity="0.7"/>
        <circle cx="50" cy="50" r="3" fill="${color}"/>
      </svg>
      <div class="gauge-val">${g.fmt(g.val)}</div>
      <div class="gauge-sublabel">${isGood ? '✔ Target Met' : '⚠ Review Required'}</div>
    </div>`;
  }).join('');
}
buildGauges();

// Gauge arc animation via CSS
const gStyle = document.createElement('style');
gStyle.textContent = `
  @keyframes drawArc {
    to { stroke-dashoffset: 0; }
  }`;
document.head.appendChild(gStyle);

// ══════════════════════════════════════════════════════
//  SECTOR DONUT (SVG)
// ══════════════════════════════════════════════════════
function buildDonut() {
  // Aggregate sectors from optimal weights
  const sectors = {};
  positions.forEach(p => {
    sectors[p.sector] = (sectors[p.sector]||0) + p.optW;
  });
  const entries = Object.entries(sectors).sort((a,b)=>b[1]-a[1]);
  const colors = ['#C8920A','#0ABFC8','#0AC871','#C8300A','#7A5808'];

  const svg = document.getElementById('donutSvg');
  const cx=60, cy=60, r=45, inner=28;
  let startAngle = -Math.PI/2;
  let paths = '';
  let legend = '';

  entries.forEach(([name, w], i) => {
    const angle = w * 2 * Math.PI;
    const endAngle = startAngle + angle;
    const x1 = cx + r*Math.cos(startAngle);
    const y1 = cy + r*Math.sin(startAngle);
    const x2 = cx + r*Math.cos(endAngle);
    const y2 = cy + r*Math.sin(endAngle);
    const ix1 = cx + inner*Math.cos(startAngle);
    const iy1 = cy + inner*Math.sin(startAngle);
    const ix2 = cx + inner*Math.cos(endAngle);
    const iy2 = cy + inner*Math.sin(endAngle);
    const large = angle > Math.PI ? 1 : 0;
    const color = colors[i % colors.length];

    paths += `<path d="M ${ix1} ${iy1} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} L ${ix2} ${iy2} A ${inner} ${inner} 0 ${large} 0 ${ix1} ${iy1} Z"
      fill="${color}" opacity="0.9" stroke="#080A0E" stroke-width="1.5"/>`;

    legend += `<div class="legend-row">
      <div class="legend-dot" style="background:${color}"></div>
      <div class="legend-name">${name}</div>
      <div class="legend-pct">${(w*100).toFixed(1)}%</div>
    </div>`;
    startAngle = endAngle;
  });

  // Center text
  paths += `<circle cx="${cx}" cy="${cy}" r="${inner}" fill="#080A0E"/>
    <text x="${cx}" y="${cy-4}" text-anchor="middle" font-family="Cormorant Garamond" 
      font-size="11" fill="#C8920A" font-weight="600">OPT</text>
    <text x="${cx}" y="${cy+9}" text-anchor="middle" font-family="DM Mono" 
      font-size="8" fill="#8A8070">ALLOC</text>`;

  svg.innerHTML = paths;
  document.getElementById('donutLegend').innerHTML = legend;
}
buildDonut();

// ══════════════════════════════════════════════════════
//  MONTE CARLO CANVAS
// ══════════════════════════════════════════════════════
function buildMonteCarlo() {
  const canvas = document.getElementById('mcCanvas');
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width  = rect.width  * dpr;
  canvas.height = 140 * dpr;
  canvas.style.width  = rect.width + 'px';
  canvas.style.height = '140px';
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);

  const W = rect.width, H = 140;
  const N = 60; // paths to draw
  const DAYS = 252;
  const dailyMu  = opt.ret / 252;
  const dailySig = opt.vol / Math.sqrt(252);
  const AUM_M = AUM / 1e6;

  // Generate paths
  const paths = [];
  for (let p=0; p<N; p++) {
    let val = AUM_M;
    const path = [val];
    for (let d=0; d<DAYS; d++) {
      const shock = dailyMu + dailySig * (Math.random()*2-1) * 1.7;
      val *= (1 + shock);
      path.push(val);
    }
    paths.push(path);
  }

  const allVals = paths.flat();
  const minV = Math.min(...allVals) * 0.97;
  const maxV = Math.max(...allVals) * 1.03;

  const toY = v => H - ((v - minV)/(maxV - minV)) * H;
  const toX = d => (d/DAYS) * W;

  // Clear
  ctx.clearRect(0,0,W,H);

  // Grid lines
  ctx.strokeStyle = '#1C2A38';
  ctx.lineWidth = 0.5;
  for (let i=1; i<4; i++) {
    const y = H/4*i;
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke();
  }

  // Draw paths
  paths.forEach((path, i) => {
    const finalVal = path[path.length-1];
    const hue = finalVal > AUM_M ? '10,200,113' : '200,48,10';
    ctx.strokeStyle = `rgba(${hue},0.12)`;
    ctx.lineWidth = 0.8;
    ctx.beginPath();
    path.forEach((v,d) => {
      const x = toX(d), y = toY(v);
      d===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    });
    ctx.stroke();
  });

  // Median path (bold)
  const medianPath = paths.map(p => p).sort((a,b)=>a[DAYS]-b[DAYS])[Math.floor(N/2)];
  ctx.strokeStyle = '#C8920A';
  ctx.lineWidth = 2;
  ctx.shadowColor = '#C8920A';
  ctx.shadowBlur = 6;
  ctx.beginPath();
  medianPath.forEach((v,d) => {
    const x = toX(d), y = toY(v);
    d===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
  });
  ctx.stroke();
  ctx.shadowBlur = 0;

  // Baseline
  const baseY = toY(AUM_M);
  ctx.strokeStyle = 'rgba(122,88,8,0.4)';
  ctx.lineWidth = 1;
  ctx.setLineDash([4,4]);
  ctx.beginPath(); ctx.moveTo(0,baseY); ctx.lineTo(W,baseY); ctx.stroke();
  ctx.setLineDash([]);

  // Monte Carlo stats
  const finals = paths.map(p=>p[DAYS]).sort((a,b)=>a-b);
  const p5  = finals[Math.floor(N*0.05)];
  const p50 = finals[Math.floor(N*0.50)];
  const p95 = finals[Math.floor(N*0.95)];

  document.getElementById('mcStats').innerHTML = `
    <div class="mc-stat">
      <div class="s-label">Pessimistic (P5)</div>
      <div class="s-val">$${p5.toFixed(0)}M</div>
      <div class="s-ret" style="color:var(--red)">${((p5/AUM_M-1)*100).toFixed(1)}%</div>
    </div>
    <div class="mc-stat">
      <div class="s-label">Base Case (P50)</div>
      <div class="s-val">$${p50.toFixed(0)}M</div>
      <div class="s-ret" style="color:var(--amber-glow)">+${((p50/AUM_M-1)*100).toFixed(1)}%</div>
    </div>
    <div class="mc-stat">
      <div class="s-label">Optimistic (P95)</div>
      <div class="s-val">$${p95.toFixed(0)}M</div>
      <div class="s-ret" style="color:var(--green)">+${((p95/AUM_M-1)*100).toFixed(1)}%</div>
    </div>`;
}
setTimeout(buildMonteCarlo, 100);

// ══════════════════════════════════════════════════════
//  RISK TABLE
// ══════════════════════════════════════════════════════
function buildRiskTable() {
  const rows = [
    ['VaR 99% (1-day)',     '$'+(opt.var99/1e6).toFixed(2)+'M'],
    ['VaR 95% (1-day)',     '$'+((opt.var99/Z99*1.6449)/1e6).toFixed(2)+'M'],
    ['CVaR 99% (Exp. Shortfall)', '$'+(opt.cvar/1e6).toFixed(2)+'M'],
    ['sep',''],
    ['Annualized Return',  (opt.ret*100).toFixed(2)+'%'],
    ['Annualized Volatility', (opt.vol*100).toFixed(2)+'%'],
    ['Sharpe Ratio',       opt.sharpe.toFixed(3)],
    ['Portfolio Beta',     opt.beta.toFixed(3)],
    ['sep',''],
    ['Risk-Free Rate',     (RF*100).toFixed(2)+'%'],
    ['Conf. Level',        '99.00%'],
    ['AUM',                '$500.0M'],
  ];

  document.getElementById('riskTable').innerHTML = rows.map(([k,v])=>
    k==='sep'
      ? `<tr><td class="risk-sep" colspan="2"></td></tr>`
      : `<tr><td>${k}</td><td>${v}</td></tr>`
  ).join('');
}
buildRiskTable();

// ══════════════════════════════════════════════════════
//  ACTIONS
// ══════════════════════════════════════════════════════
function rebalance() {
  const btn = document.querySelector('.action-btn.exec');
  btn.textContent = '⟳ Processing order...';
  btn.disabled = true;
  btn.style.color = 'var(--amber)';
  setTimeout(() => {
    btn.textContent = '✔ Rebalancing Order Submitted';
    btn.style.borderColor = 'var(--green)';
    btn.style.color = 'var(--green)';
  }, 1800);
}

function exportReport() {
  const data = {
    fund: 'Alpha Capital Management',
    date: new Date().toISOString(),
    aum: AUM,
    current: cur,
    optimal: opt,
    positions: positions.map(p=>({
      ticker: p.ticker, sector: p.sector,
      currentWeight: p.curW, optimalWeight: p.optW
    }))
  };
  const blob = new Blob([JSON.stringify(data, null, 2)],
    {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'AlphaCapital_RiskReport.json';
  a.click();
}
</script>
</body>
</html>
